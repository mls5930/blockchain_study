### 우리 EC2환경은?

직접 실행시키고, 직접 실행을 끄니까 `포그라운드`  
즉, 우리 EC2 콘솔 브라우저 자체를 끄면 서버 프로세스도 끊김
=> 24시간 돌릴 수 없음.

### 어?? 그러면 백그라운드에 흐르게 하면 되겠네?

맞아!
그것과 관련된 라이브러리가 PM2

## PM2란?

Process Manager 2  
Node.js 애플리케이션을 효율적으로 실행하고 관리하는 프로세스 매니저에요.

### 주요 특징

- 서버가 꺼져도 계속 실행되도록 관리
=> Node.js (express) 서버가 죽지 않고 계속 실행되도록 도와주는 도구!

## PM2와 백그라운드/포그라운드 관계

### 프로그램과 프로세스

#### 프로그램

윈도우 기준으로 프로그램은 어떤게 있을까?

- 크롬
- 카카오톡
- ZOOM

실행 가능한 파일(코드의 집합)

#### 프로세스

실행중인 프로그램
하나의 프로그램은 여러 프로세스를 가질 수 있다.

---

#### 포그라운드 프로세스

눈으로 보임
사용자가 직접 실행하며 사용자와 상호작용하는 프로세스

ex) 카톡, 크롬, ZOOM

---

#### 백그라운드 프로세스

눈에 보이지 않음
사용자와 직접적으로 상호작용 하지 않고, 보이지 않는곳에서 동작하는
프로세스

ex:) 윈도우 자동 소프트웨어 업데이트

프로세스 안에서 실행되는 작업의 최소 단위

- 즉, PM2는 서버를 종료해도 백그라운드에서 계속 실행되게 해준다.
- 터미널을 닫아도 애플리케이션이 계속 동작

## PM2 작동원리

PM2는 **메인 프로세스와 여러 워커 프로세스(앱 인스턴스)로 구성됨**
즉, PM2는 하나의 **중앙관리자(마스터 프로세스)**가 여러 개의 애플리케이션  
프로세스를 관리하는 방식으로 동작

즉, PM2가 "관리자 역할"을 하며,  
여러 개의 애플리케이션 프로세스를 실행 및 감시하는 구조!

### PM2 작동원리

#### 1. 애플리케이션 프로세스 실행

```sh
pm2 start server.js
```

위의 명령어를 실행하면 마스터 프로세스가 애플리케이션 프로세스를  
생성하고 실행.

- 실행하면 마스터 프로세스가 Node.js 애플리케이션을 실행하고 이를 관리합니다.
- 이때, 백그라운드에서 실행되므로 터미널을 닫아도 계속 동작합니다.

#### 2. 애플리케이션 모니터링 및 자동 재시작

PM2는 실행된 애플리케이션을 주기적으로 체크합니다.  

- 만약 애플리케이션이 크래시(충돌)되거나 종료되면?
- 마스터 프로세스가 이를 감지하고 즉시 재시작합니다.

## PM2 실행 흐름

1. 사용자가 `pm2 start server.js` 실행
2. PM2 마스터 프로세가 실행
3. Node.js 런타임을 이용해 server.js 실행
4. 실행된 프로세스를 백그라운드에서 관리
5. package.json의 start 스크립트는 pm2 start npm -- start를 실행될떄만 사용됨

### PM2가 작동하는 방식

- pm2 start server.js => 직접 server.js 실행 (package.json과 무관)
- pm2 start npm -- start => package.json의 scripts.start 실행
- pm2 start ecosystem.config.js => PM2 설정 파일을 통해 여러 개의 앱 실행