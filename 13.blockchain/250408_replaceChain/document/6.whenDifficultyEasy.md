# 5.whenDifficultyEasy.md

## 4ë‹¨ê³„: ë‚œì´ë„ ì¡°ì •ì´ ì¼ì–´ë‚˜ëŠ” íë¦„ì„ ë§Œë“ ë‹¤

---

## âœ… ëª©í‘œ

> 5ë‹¨ê³„ì—ì„œ **ë‚œì´ë„ê°€ ì§„ì§œ ë°”ë€ŒëŠ”ì§€ í™•ì¸**í•˜ë ¤ë©´,  
> ë¨¼ì € **ë¸”ë¡ì„ 11ê°œê¹Œì§€ ìŒ“ì•„ì„œ ì¡°ì • ì‹œì ì„ ë§Œë“¤ì–´ì•¼** í•©ë‹ˆë‹¤.

---

## ë°˜ë³µë¬¸ íë¦„ ìš”ì•½

```ts
for (let i = 1; i <= DIFFICULTY_ADJUSTMENT_INTERVAL + 1; i++) {
  ...
  const newBlock = Block.generateBlock(prev, data, adjustment);
  chain.addToChain(newBlock);
}
```

- `i = 1 ~ 11`ê¹Œì§€ ë¸”ë¡ ìƒì„±
- 11ë²ˆì§¸ ë¸”ë¡ì€ **ì¡°ì • ì‹œì **
- ì´ íë¦„ ì•ˆì—ì„œ ë‚œì´ë„ íŒë‹¨ì´ **ìë™ ì‹¤í–‰**ë©ë‹ˆë‹¤

---

## í•µì‹¬ íë¦„

### 1. adjustment ë¸”ë¡ ì§€ì •

```ts
if (i > DIFFICULTY_ADJUSTMENT_INTERVAL) {
  const index = i - DIFFICULTY_ADJUSTMENT_INTERVAL;
  adjustment = chain.get()[index]; // ì˜ˆ: 11 - 10 = 1ë²ˆ ë¸”ë¡
} else {
  adjustment = GENESIS;
}
```

> **ì¡°ì • ì‹œì (i > 10)**ì´ ë˜ë©´ â†’ `adjustment`ëŠ” 1ë²ˆ ë¸”ë¡ì´ ë¨

---

### 2. ë¸”ë¡ ìƒì„± â†’ ë‚´ë¶€ì ìœ¼ë¡œ ë‚œì´ë„ ê³„ì‚° ë°œìƒ

```ts
const newBlock = Block.generateBlock(prev, data, adjustment);
```

â†’ ì´ ì•ˆì—ì„œ `new Block(...)` í˜¸ì¶œë¨
â†’ **constructor() ì•ˆì—ì„œ** ë‚œì´ë„ ê²°ì •

---

### 3. ìƒì„±ì ë‚´ë¶€ì—ì„œ ë‚œì´ë„ ê³„ì‚°

```ts
this.difficulty = Block.getDifficulty(this, _adjustmentBlock, _previousBlock);
```

â†’ ì´ ìˆœê°„ ì‹¤ì œë¡œ `getDifficulty()`ê°€ ì‹¤í–‰ë¨

---

## getDifficulty ë‚´ë¶€ í•µì‹¬ë§Œ ë³´ì

```ts
if (height % 10 !== 0) return previous.difficulty;

const timeToken = newBlock.timestamp - adjustment.timestamp;
const expected = 10ì´ˆ * 10ê°œ;

if (timeToken < expected / 2) return previous.difficulty + 1;
if (timeToken > expected * 2) return previous.difficulty - 1;
```

| ì¡°ê±´      | ê²°ê³¼        |
| --------- | ----------- |
| ë„ˆë¬´ ë¹ ë¦„ | +1          |
| ë„ˆë¬´ ëŠë¦¼ | -1          |
| ì ì ˆí•¨    | ê·¸ëŒ€ë¡œ ìœ ì§€ |

---

## ì—¬ê¸°ì„œ ê¸°ì–µí•´ì•¼ í•  íë¦„

> ë‚œì´ë„ëŠ” ë¸”ë¡ ìƒì„± ì‹œ ê²°ì •ëœë‹¤.
> ì¡°ì • ì£¼ê¸°ì— ë„ë‹¬í•˜ë©´ â†’ `adjustment`ì™€ `previous`ë¥¼ ë¹„êµí•´ì„œ ë‚œì´ë„ ì¡°ì ˆ
> ì´ ê³„ì‚°ì€ **`constructor` ë‚´ë¶€**ì—ì„œ ìë™ìœ¼ë¡œ ì¼ì–´ë‚œë‹¤.

---

## ğŸ§­ ì „ì²´ íë¦„ ì •ë¦¬ (í•œëˆˆì—)

```text
[prev: 10] + [adjustment: 1] â†’ generateBlock()
â†’ new Block(...) â†’ constructor()
â†’ getDifficulty(this, adjustment, prev)
â†’ ë‚œì´ë„ ê²°ì •
```

---

## âœ… ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ”?

> ì‹¤ì œë¡œ **ì´ íë¦„ì„ í†µí•´ ë‚œì´ë„ê°€ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸**í•©ë‹ˆë‹¤.
> â†’ `expect(adjustment.difficulty).not.toBe(prev.difficulty);`
