# ⚠️ 주의 사항 – 무엇을 구현하고, 무엇을 우선 다룰 것인가?

이번 단계부터는 **React UI를 통해 스마트 컨트랙트와 직접 상호작용**하는 구조로 넘어갑니다.
즉, Remix에서 버튼을 눌러 호출하던 함수들을
**웹 페이지의 버튼을 통해 실행하고**,
그 결과를 **Metamask 서명과 함께 트랜잭션으로 전송하는 흐름**을 직접 구현하게 됩니다.

하지만 먼저 한 가지를 분명히 해두겠습니다.

## ❌ `transfer()` 메서드에 대한 UI 코드는 이번에 다루지 않습니다.

토큰을 직접 보내는 `transfer(to, amount)`는
여러분이 이미 Remix에서 충분히 익혔고,
별도로 화면에 구현해볼 수 있는 난이도입니다.

> **이 부분은 과제로 남기겠습니다.**
> 실제로 토큰을 전송하고, Metamask에 반영되는지 확인해보세요.
> 필요한 코드는 기존 `getContract.ts`와 `web3.eth.Contract` 활용 구조로 충분히 가능합니다.

## 이번 시간에 집중할 흐름

저는 오늘 다음의 **두 가지 흐름에만 집중하겠습니다**:

1. **권한 위임 (`approve`)**
   → 화면 상에서 “게임에 참가하시겠습니까?” 버튼 클릭
   → 해당 토큰 양에 대해 `BaseballGame` 컨트랙트에게 사용 권한을 위임

2. **게임 시작 (`gameStart`)**
   → 사용자가 숫자를 입력하고 “게임 시작” 버튼 클릭
   → 내부적으로 `transferFrom()` 실행 → 참가비 회수 및 보상 풀 적립

---

이 두 흐름은 단순히 UI로 구현하는 것이 목적이 아닙니다.

> **"서명 주체는 누구인가?"**,
> **"실행 주체는 누구인가?"**,
> **"왜 approve 없이는 transferFrom이 실패하는가?"**
> 이러한 개념을 **직접 몸으로 체득하는 구조를 만드는 것이 이번 단계의 핵심**입니다.

## `approve()` + `transferFrom()` UI 구현 – 권한 위임과 보상 수령 흐름 체화

이번 단계에서는 두 가지 상호작용 흐름을 화면 위에서 구현해보겠습니다.

1. **게임 참가를 위한 권한 위임 (`approve`)**
2. **숫자를 입력하고 게임을 시작하는 흐름 (`transferFrom()`이 내부에서 실행됨)**

---

### 1단계 – 권한 위임 버튼 만들기

```tsx
<button onClick={approve}>🎫 게임 참가 권한 위임 (approve)</button>
```

사용자가 클릭하면 `approve()` 함수가 실행되도록 버튼을 구성합니다.

---

### `approve()` 함수 선언

```ts
const approve = async () => {
```

이 함수는 토큰 컨트랙트에게 특정 양의 토큰을
**BaseballGame 컨트랙트가 사용할 수 있도록 허락하는 역할**을 합니다.

---

```ts
const amount = web3.utils.toWei("1000", "ether"); // ticket 가격
```

`1000 MTK`를 `wei` 단위로 변환합니다.
ERC-20은 18자리 소수점이기 때문에, 실제 내부 단위는 `10^18`이 기준입니다.

---

```ts
await myTokenContract.methods
  .approve(contractAddress, amount)
  .send({ from: account });
```

`approve()` 메서드를 호출합니다.
여기서 `contractAddress`는 반드시 **게임 컨트랙트의 CA 주소**여야 합니다.
→ **`MyToken` 컨트랙트가 아니라**, **`BaseballGame`이 토큰을 사용할 주체이기 때문**입니다.

---

```ts
alert("권한 위임 완료 (approve)");
```

권한 위임이 정상적으로 끝나면, 사용자에게 알림을 띄워줍니다.

※ 참고: `alert()`은 **개발/실습 단계에선 편리하지만**,
실제 현업에서는 **UX 흐름 차단, 비동기 컨트롤 문제 등**으로 사용을 지양합니다.
→ 현업에서는 모달, 토스트 메시지 등으로 대체합니다.

---

### 2단계 – 게임 시작 버튼 만들기

```tsx
<button onClick={startGame}>🚀 게임 시작</button>
```

사용자가 숫자를 입력하고, 이 버튼을 누르면 게임이 실행됩니다.

---

### `startGame()` 함수 선언

```ts
const startGame = async () => {
```

사용자가 고른 숫자(`input` 값)를 가지고
**BaseballGame 컨트랙트의 `gameStart()` 함수를 호출합니다.**

---

```ts
await baseBallContract.methods
  .gameStart(parseInt(input))
  .send({ from: account });
```

이때 서명 주체는 **`account`**, 즉 사용자의 EOA입니다.
하지만 실제 `transferFrom()`을 실행하는 건 **BaseballGame 컨트랙트**입니다.
→ 이게 바로 `approve`가 필요한 이유이기도 합니다.

---

```ts
alert("게임 실행 완료");
```

게임이 정상적으로 실행되었을 경우, 사용자에게 결과를 알려줍니다.
(마찬가지로 현업에서는 alert 대신 모달 또는 UI 상태 변화로 대체합니다.)

## 이 흐름을 통해 체득해야 할 핵심

- `approve()`는 **BaseballGame 컨트랙트가 내 토큰을 가져가도 좋다고 허락하는 행위**입니다.
- `transferFrom()`은 직접 호출하는 게 아니라,
  **게임 컨트랙트 내부에서 실행되는 구조이기 때문에 위임이 선행되어야 합니다.**

## 이 흐름이 익숙해지면?

- DeFi의 스테이킹, NFT 민팅, DAO 투표 등 **모든 복합 스마트 컨트랙트 실행의 기본 구조**가 이해됩니다.
- 이제 단순한 트랜잭션이 아니라,
  **책임 주체, 서명 주체, 실행 주체가 나뉘는 스마트 컨트랙트 설계 철학**까지 체감하게 될 것입니다.
