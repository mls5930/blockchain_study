# 전체 실행 흐름 – React + Metamask + 스마트컨트랙트까지 연결된 완성된 플로우

자!
이제 화면도 구현했고, 버튼도 눌러봤고,
Metamask와도 실제로 서명하고 트랜잭션까지 날려봤습니다.

그렇다면 여기서 한 번,
**전체 흐름을 "유저 입장"에서 다시 복기**해봅시다.

---

## 단계별 흐름

1. **게임 배포**

   - 오너가 Remix 혹은 React로 컨트랙트를 배포합니다.
   - `mint()`를 호출하여, 토큰을 새로 발행합니다.

2. **우리 베이스볼 게임 DApp을 홍보했다고 가정합시다**

   - 특정 유저(user1)에게 1000 MTK를 보상으로 줍니다.
     → 이는 오너가 `transfer(user1, 1000 * 10^18)`로 지급한 것입니다.

3. **게임에 참가하시겠습니까? → 버튼 클릭**

   - 유저는 `approve()`를 호출합니다.
   - 이때 위임 대상은 **BaseballGame 컨트랙트**입니다.
     → 즉, **CA가 내 토큰 100개를 가져가도 된다**는 허락을 한 셈입니다.

4. **유저가 숫자를 입력하고 → 게임 시작 버튼 클릭**

   - `gameStart(123)` 호출 → 내부에서 `transferFrom()` 실행됨
   - 유저의 지갑에서 CA로 **100 MTK가 이동**합니다.
   - 이 토큰은 `reword` 풀로 누적됩니다.

5. **게임 실패 시**

   - 보상은 주어지지 않고,
   - 참가비였던 토큰은 `CA`가 그대로 보관합니다.
     → `reword += 100` 으로 누적만 됩니다.

6. **다시 게임 참가 → 다시 권한 위임**

   - 이전에 위임한 100이 소진되었기 때문에,
   - 유저는 다시 `approve()`를 호출하여 새로 권한을 위임해야 합니다.

7. **다시 숫자 입력 → 게임 시작**

   - CA가 또 `transferFrom()` 호출 → 또 100 MTK 회수
   - `reword`는 계속 누적됩니다.

8. **게임 성공 시**

   - 드디어 입력한 숫자가 정답과 일치하면,
   - `CA`는 `transfer(user1, reword)`를 호출해
     누적된 보상 전부를 유저에게 지급합니다.

9. **10판 게임을 모두 실패했다면?**

   - 게임 상태가 `gameOver`가 되고,
   - 유저는 보상을 받지 못합니다.
   - 대신, CA는 보유한 `reword`를 **오너에게 넘깁니다.**

10. **최종 결과**

    - **승자가 생기면** → CA → 유저에게 보상 지급
    - **끝까지 실패하면** → CA → 오너에게 보상 귀속

---

## 그런데 질문 하나!

> 오너에게 귀속하는 함수는 아직 없지 않나요?

맞습니다.

---

## 그래서 오늘의 실습 과제

> “게임이 끝났을 때, 오너가 남은 토큰을 회수할 수 있도록
> transfer 함수 기반으로 `withdrawToOwner()`를 직접 구현해보세요.”

**조건은 단순합니다.**

- 오직 오너만 호출할 수 있어야 하고 (`require(msg.sender == owner)`)
- `reword`가 남아 있어야 하고
- 게임이 종료된 상태여야 합니다

이건 우리가 앞에서 다 배운 내용으로 충분히 만들 수 있습니다.
아주 쉬운 과제입니다. 오늘 안으로 실습 문제로 제공해드리겠습니다.
