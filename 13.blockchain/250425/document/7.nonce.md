# **nonce: 한 번만 쓰이는 숫자**

---

우리가 블록체인에서 자주 마주치는 단어, `nonce`.

처음엔 생소하게 느껴질 수 있지만, 사실 이 단어의 어원은 아주 단순합니다.

- **nonce**는 “**for the once**”라는 고어 표현에서 유래한 단어입니다.
- 말 그대로 “**한 번만 쓰이는 숫자**”를 의미해요.

---

이 개념은 암호학에서 꽤 중요하게 쓰이는데,  
중복 방지, 고유성 보장, 인증 토큰 등  
**“한 번만 쓰이도록 보장해야 하는 상황”**에서 자주 등장합니다.

---

## 그런데… 블록체인에서는?

흥미롭게도, 블록체인에서는 `nonce`가 **두 가지 전혀 다른 의미**로 쓰입니다.

> **비트코인에서의 nonce**와  
> **이더리움에서의 nonce**는  
> 이름은 같지만, 역할과 맥락은 완전히 다릅니다.

---

## 1. **비트코인의 nonce: 퍼즐 조각**

- 위치: **블록 헤더**
- 목적: 작업 증명(Proof of Work)을 위한 무작위 수

비트코인에서는 특정 조건의 해시값(예: `0000...`)을 맞추기 위해  
`nonce`를 계속 바꿔가며 **수천억 번의 시도를 반복**합니다.

```plaintext
while (sha256(blockHeader) >= target) {
    nonce += 1;
}
```

> 즉, 이 nonce는 **채굴자가 문제를 푸는 데 사용하는 시드값**입니다.  
> 고정된 입력에 무작위성을 부여하는 역할이죠.

---

## 2. **이더리움의 nonce: 순서를 위한 트래킹 넘버**

반면 이더리움에서의 `nonce`는 완전히 다른 개념입니다.

- 위치: **계정 속성**
- 의미: **"이 계정이 지금까지 몇 개의 트랜잭션을 보냈는가?"**

```js
const nonce = await web3.eth.getTransactionCount(account);
```

→ 즉, 이 계정이 지금 보내는 건 **N번째 트랜잭션**입니다.

### 여기까지만 보면:

"아~ 트랜잭션 순번이구나" 싶겠지만,  
사실 이건 **훨씬 중요한 구조적 역할**을 합니다.

# 지금부터 진짜 중요한 얘기입니다

---

## 질문: 내가 몇 번째 트랜잭션을 보내고 있지?

이건 단순한 정보가 아니라,  
**블록체인 네트워크가 트랜잭션을 정렬하고 구분하는 기준**입니다.

> 즉, **트랜잭션 정렬의 기준은 해시가 아니라 nonce입니다.**

---

### 왜 정렬이 필요할까?

우리가 컨트랙트에 다음처럼 두 개의 요청을 보낸다고 해봅시다:

1. `counter + 1`
2. `counter + 100`

근데 두 번째가 먼저 실행되면?  
그 다음 `+1`은 이상한 결과를 만들 수 있죠.  
→ 그래서 **트랜잭션은 순서를 반드시 지켜야 합니다.**

---

## 근데… 트랜잭션은 실패할 수도 있잖아?

맞아요.  
Etherscan에서도 `status: failed` 확인해봤죠?

실패하면 끝날까요?

아니요.  
**실패했다고 바로 사라지지 않습니다.**

---

## 핵심 문제: 실패한 트랜잭션이 처리 중인데, 그 다음 걸 보내면?

- 이전 nonce를 가진 트랜잭션이 아직 _대기 중_
- 그 상태에서 **다음 nonce**를 가진 트랜잭션을 보내면?
- → **꼬입니다.**

왜냐하면…

> **EVM은 트랜잭션을 “해시값”으로 추적하지 않습니다.**  
> **“nonce”로 구분합니다.**

---

### 와… 그럼 취소하고 싶을 땐?

"그 트랜잭션 해시로 삭제하면 안 돼요?"

→ **불가능합니다.**  
EVM은 해시 기반이 아니라 nonce 기반 정렬을 하니까요.

---

## 그래서 정리하자면:

- **이더리움에서 nonce는 트랜잭션의 고유 ID이자 순번입니다.**
- 같은 nonce를 가진 트랜잭션은 단 하나만 존재 가능
- nonce 충돌이 생기면 아무 것도 처리되지 않음
- **다음 트랜잭션은 이전 nonce가 처리되기 전까진 절대 실행 안 됨**

---

## 표로 다시 한 번 정리

| 항목         | 비트코인                 | 이더리움                       |
| ------------ | ------------------------ | ------------------------------ |
| 위치         | 블록 헤더                | 계정 속성 / 트랜잭션 필드      |
| 의미         | 퍼즐 풀기 위한 무작위 수 | 트랜잭션 순서 및 ID            |
| 목적         | PoW 난이도 만족          | 중복 방지 + 순서 보장          |
| 값 증가 기준 | 퍼즐 실패 시 계속 증가   | 트랜잭션 1개 보낼 때마다 +1    |
| 충돌 시 처리 | 상관없음 (계속 시도)     | 오류 발생 → 이후 트랜잭션 대기 |

---

## 마무리

`nonce`는 단순히

> “트랜잭션 몇 번째예요~” 라고 알려주는 숫자에서 끝나는게 아닙니다.

> **이더리움의 트랜잭션 처리 질서를 지키는 핵심 열쇠**입니다.

잘못된 nonce 하나는  
당신의 트랜잭션 전부를 멈추게 할 수 있어요.
