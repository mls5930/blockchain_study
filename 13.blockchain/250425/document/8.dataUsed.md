# 컨트랙트 배포 트랜잭션 – 코드 자체를 보내는 트랜잭션

---

## 1. 함수 실행 vs. 컨트랙트 배포

앞에서 `reset()` 같은 함수를 실행할 땐 트랜잭션에 이렇게 담았죠:

```json
{
  "to": "0x컨트랙트주소",
  "data": "0x3f4ba83a"
}
```

즉,

- `to`: 실행할 대상 주소
- `data`: 어떤 함수를 실행할지

---

그런데… 컨트랙트 배포는 조금 다릅니다.

> 그건 **“지금 존재하지 않는 주소에, 새로운 코드를 업로드하겠다”**는 요청입니다.

---

## 2. 컨트랙트 배포 시 `to`는 없습니다

컨트랙트를 배포하는 트랜잭션은 다음과 같은 구조입니다:

```json
{
  "to": null,
  "data": "0x60806040..." // 컴파일된 바이트코드 전체
}
```

- `to`: 없음 → 아직 이 컨트랙트는 존재하지 않기 때문
- `data`: 배포하고 싶은 컨트랙트의 **전체 바이트코드**

이건 EVM에게 이렇게 말하는 것과 같습니다:

> “여기 코드를 하나 보낼 테니, 네가 이걸 네트워크에 심어서 새로운 주소를 만들어줘.”

---

## 3. 그럼 `data` 안에는 뭐가 들었나?

컨트랙트를 컴파일하면 두 가지 파일이 나오죠:

- `.abi`: 외부 인터페이스
- `.bin`: **순수 바이트코드 (bytecode)**

이 `.bin` 파일의 내용이 바로 `data`에 들어가는 겁니다.

```js
const bytecode = "0x" + fs.readFileSync("Counter.bin", "utf8");

const tx = {
  from: myAccount,
  data: bytecode, // 컨트랙트 전체 코드
  gas,
};
```

---

## 4. 배포 시에 실행되는 특별한 코드 – Constructor

배포 트랜잭션의 `data`는 단순히 코드만 보내는 게 아닙니다.  
EVM은 이 코드를 받아 **한 번 실행합니다.**

> 그게 바로 `constructor()`입니다.

- constructor는 실행되며,
- **"이 컨트랙트의 최종 코드"**를 return합니다.
- 이 결과가 **영구 저장**되어, 컨트랙트의 코드가 됩니다.

즉, `data`에는 단순한 코드가 아니라  
**constructor를 포함한 초기 실행 코드 전체**가 들어 있습니다.

---

## 5. 이 트랜잭션은 어디에 저장되나?

EVM은 이 트랜잭션을 처리한 후:

1. 새로운 주소를 생성하고
2. constructor 실행 결과(return 값)를 그 주소에 **code로 저장**합니다
3. 그 주소가 바로 **컨트랙트 주소 (CA)**가 됩니다

```js
const deployedContract = await new web3.eth.Contract(abi)
  .deploy({ data: bytecode }) // 👈 여기에 들어가는 data
  .send({ from: address, gas });
```

---

## 6. 정리 – 실행 vs. 배포 트랜잭션 비교

| 항목      | 함수 실행 트랜잭션                   | 컨트랙트 배포 트랜잭션                      |
| --------- | ------------------------------------ | ------------------------------------------- |
| `to`      | 컨트랙트 주소                        | 없음 (`null`)                               |
| `data`    | 실행할 함수의 selector + 인자 인코딩 | 컨트랙트 전체 바이트코드 (`bytecode`)       |
| 실행 대상 | 기존에 존재하는 코드                 | 아직 존재하지 않는 새로운 코드              |
| 결과      | 상태 변화                            | 새로운 컨트랙트가 생성됨 + 고정된 주소 부여 |
| 실행 목적 | 특정 로직 수행                       | 네트워크에 새로운 코드 심기                 |

---

## 7. 철학적으로 정리하자면

> **일반 트랜잭션은 "실행 요청"이라면,  
> 배포 트랜잭션은 "코드 전달"입니다.**

- EVM에게 “이거 실행해줘” → `to` + `data`
- EVM에게 “이 코드 심어줘” → `to=null` + `data=bytecode`

---

## 마무리

그래서 컨트랙트 배포 트랜잭션의 핵심은  
→ **to가 없다.**  
→ **data에는 코드 전체가 들어간다.**  
→ **constructor가 실행되고, 그 결과가 코드로 저장된다.**
