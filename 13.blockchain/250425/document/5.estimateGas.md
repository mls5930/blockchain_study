# 얼마나 연산이 필요할까?

## `estimateGas()`는 실행의 실패를 막고, 책임을 준비하는 도구다

---

## 1. 블록체인에서 실행은 공짜가 아닙니다

이더리움에서 어떤 코드를 실행할 때는 반드시 `gas`를 설정해야 합니다.  
여기서 `gas`는 단순한 수수료가 아닙니다.

> 정확히 말하면, **"내가 이 실행을 위해 최대 이만큼의 연산량(gas)을 감당하겠습니다"**  
> 라고 **명확히 선언하는 것**입니다.

이 값은 트랜잭션의 `gas` 필드에 들어가며,  
이는 곧 **EVM이 받아들이는 `gasLimit`** 역할을 합니다.

---

## 2. 그런데 얼마를 넣어야 할까요?

이게 바로 고민입니다.

- 너무 적게 넣으면?  
  → 실행 도중 중단 (Out of Gas) → 실패 → 수수료 날림
- 너무 많이 넣으면?  
  → 잔여 gas는 환불되긴 하지만, 불필요하게 높게 설정할 이유는 없습니다

즉,

> **정확한 실행을 위해 "적정 gas"를 미리 계산할 필요**가 있습니다.

---

## 3. 그래서 등장한 도구 – `estimateGas()`

이 함수는 말 그대로:

> **"지금 이 컨트랙트 상태에서 이 함수를 실행하면  
> 얼마만큼의 gas가 필요할까요?"** 를 예측하는 함수입니다.

다시 말해,  
트랜잭션을 실제로 실행하지 않고도,  
**“이 함수가 제대로 실행되기 위해 필요한 최소 gas”**를 알려주는 거예요.

---

## 4. 이 값은 어디에 쓰일까?

여기서 핵심입니다.

> `estimateGas()`는 단순히 “궁금해서 물어보는 것”이 아니라,  
> **“트랜잭션을 안전하게 구성하기 위해 필요한 값을 구하는 것”입니다.**

우리가 이 값을 구하는 이유는,  
바로 **트랜잭션 객체의 `gas` 필드**에 이 값을 넣기 위해서입니다:

```js
const gas = await contract.methods.reset().estimateGas({ from: account });

contract.methods.reset().send({
  from: account,
  gas: gas, // 👈 여기! = gasLimit
});
```

여기서 `gas`는 곧

> **“EVM에게 이 실행을 허락해주는 최대 연산 한도”**, 즉 `gasLimit`으로 인식됩니다.

---

## 5. 안 넣어도 되긴 해요, 하지만…

Web3.js는 기본적으로 `send()`할 때  
내부적으로 `estimateGas()`를 자동으로 호출해서  
적당한 값을 넣어줍니다.

하지만…

- 여러 트랜잭션을 일괄 실행해야 할 때
- 정확한 비용을 계산해서 사용자에게 알려줘야 할 때
- 실패를 미리 감지하고 싶을 때
- 수동으로 `sendTransaction()`을 구성할 때

> 이럴 땐 반드시 내가 `estimateGas()`로  
> **직접 구하고 직접 넣어야** 합니다.

---

## 6. 요약 – `estimateGas()`는 이런 흐름에 쓰입니다

| 단계                       | 설명                                         |
| -------------------------- | -------------------------------------------- |
| `estimateGas()` 호출       | “이 코드 실행하려면 gas 얼마쯤 필요해요?”    |
| 반환값 → `gas` 필드에 사용 | 트랜잭션의 `gasLimit` 설정                   |
| 실행                       | 실행 중 `gasUsed` 만큼만 소비, 나머지는 환불 |
| 실패 방지                  | 너무 적게 넣어 Out of Gas 되는 실수 방지     |

---

## 정리 하나로 마무리

> `estimateGas()`는  
> **"실행을 예측하고, 실패를 방지하며, 책임 있게 트랜잭션을 구성하기 위한"**  
> **트랜잭션 설계 도구**입니다.

그리고 이 함수로 구한 값은

> 트랜잭션 객체 안의 `gas` 필드로 들어가며,  
> 이는 곧 EVM이 받아들이는 **`gasLimit`**으로 작동합니다.
