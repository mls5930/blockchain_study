# 보조 구성: `config.ts` – NODE_ID에 따라 포트 설정하기

---

## 그런데… 왜 이런 설정 파일이 따로 필요할까?

우리는 하나의 컴퓨터에서

> `node1`, `node2`라는 **서로 다른 두 노드**를 실행하고 있어요.

이 말은 즉,  
**서로 다른 포트 번호**를 사용해서 **서로에게 연결**해야 한다는 뜻이죠.

근데 코드를 짜다 보면 이런 문제가 생깁니다:

- `"4000"` 하드코딩 → 또 `"4001"` 하드코딩
- `"8080"`은 얘 거고 `"8081"`은 쟤 거고… 헷갈림
- 상대방의 포트도 계속 바뀌니까 어디서 수정해야 할지 혼란

---

## 그래서 나온 게 `getConfig()` 함수예요

`NODE_ID`를 기준으로  
각 노드가 사용할 포트와 상대 노드의 정보를 **자동으로 설정**해줍니다.

```ts
export const getConfig = (NODE_ID: string = "node1") => {
  return {
    nodeId: NODE_ID,
    httpPort: NODE_ID === "node1" ? 4000 : 4001,
    p2pPort: NODE_ID === "node1" ? 8080 : 8081,
    peerPort: NODE_ID === "node1" ? 8081 : 8080,
    peerHost: "127.0.0.1",
  };
};
```

---

## 각 속성 설명

| 속성명     | 설명                                                              |
| ---------- | ----------------------------------------------------------------- |
| `nodeId`   | 현재 실행 중인 노드의 ID (예: node1 또는 node2)                   |
| `httpPort` | 이 노드가 웹 브라우저용으로 열 HTTP 포트 번호                     |
| `p2pPort`  | 이 노드가 소켓 서버를 열 포트 번호 (다른 노드가 이 포트로 접속함) |
| `peerPort` | 이 노드가 연결을 시도할 **상대 노드의 소켓 포트 번호**            |
| `peerHost` | 상대 노드의 IP 주소 (로컬 환경에서는 127.0.0.1 고정)              |

---

## 실행 예시

```bash
NODE_ID=node1 ts-node src/core/index.ts
```

이렇게 실행하면 `getConfig()`는 다음 값을 반환해요:

```ts
{
  nodeId: "node1",
  httpPort: 4000,
  p2pPort: 8080,
  peerPort: 8081,
  peerHost: "127.0.0.1"
}
```

반대로 node2를 실행하면:

```ts
{
  nodeId: "node2",
  httpPort: 4001,
  p2pPort: 8081,
  peerPort: 8080,
  peerHost: "127.0.0.1"
}
```

---

## 정리

> `config.ts`는 각 노드가 사용하는 포트를 자동으로 정리해주는 **포트 설정 매니저**입니다.  
> 매번 하드코딩할 필요 없이, `NODE_ID`만 다르게 주면  
> 모든 네트워크 연결 정보가 깔끔하게 설정됩니다.
