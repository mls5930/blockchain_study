# 어떤 구조로 만들 건가요?

1. `type`이라는 값으로 요청의 종류를 구분합니다.
2. `payload`에는 실제 데이터를 담습니다.
3. 이 둘을 묶은 `IMessage`라는 구조를 만들어서, 앞으로 주고받는 모든 메시지에 사용할 겁니다.

## 어떻게 구현하나요?

> 파일 경로: `src/core/server/interface/message.interface.ts`

```ts
import Block from "@core/block/block";

// 1. 요청 종류를 미리 정의합니다.
export enum MessageType {
  latestBlock = "latestBlock", // 최신 블록 요청
  allBlock = "allBlock", // 전체 블록 요청
  addBlock = "addBlock", // 새로운 블록 추가 요청
}

// 2. 메시지 구조를 정의합니다.
export interface IMessage {
  type: MessageType; // 어떤 종류의 요청인지
  payload: Block | Block[]; // 보낼 데이터 (블록 1개 또는 블록 목록)
}
```

## 설명 포인트

| 항목               | 설명                                                               |
| ------------------ | ------------------------------------------------------------------ | -------------------------------------------------------------------------------- |
| `enum MessageType` | 요청의 종류를 정해둔 목록입니다. 오타 없이, 자동완성도 지원됩니다. |
| `IMessage`         | 모든 메시지는 `type`과 `payload` 두 가지로 구성됩니다.             |
| `Block             | Block[]`                                                           | 블록 하나만 보낼 수도 있고, 여러 개를 보낼 수도 있기 때문에 이렇게 설정했습니다. |

---

### 앞으로 어떻게 쓰일까요?

- 클라이언트는 `type`에 맞는 메시지를 만들어 서버로 보냅니다.
- 서버는 메시지를 받으면, `type`을 기준으로 작업을 나눕니다.
- 내일 수업에서는 여기에 `"broadcastTransaction"` 같은 타입이 새로 추가됩니다.

---

### 정리

- 지금 정의하는 건 **P2P 메시지의 기본 규칙**입니다.
- 모든 통신은 이 구조를 기반으로 이루어지며, 이 규칙이 잘 잡혀 있어야 다음 단계가 수월해집니다.

좋아! 그 다음으로 `p2p.interface.ts`를 다룰 차례지.  
앞서 `message.interface.ts`에서 **통신 메시지의 형식**을 정의했다면,  
이제는 그 메시지를 **수신할 수 있는 구조(인터페이스)**를 설계해야 할 때야.

---

## P2P 인터페이스 정의하기 (`p2p.interface.ts`)

---

### 왜 인터페이스를 만들까요?

P2P 통신은 **네트워크 구조의 핵심**입니다.  
우리는 앞으로 여러 기능을 이 P2P 모듈에 추가하게 됩니다. 예를 들면:

- 블록 전체 요청 받기
- 트랜잭션 브로드캐스트 처리
- 브로드캐스트 기능 확장 등

이런 기능들이 하나의 클래스 안에 점점 추가될 건데,  
**기본적인 구조(contract)**를 미리 명확히 정의해두면 아래와 같은 장점이 있습니다:

| 이유                 | 설명                                                              |
| -------------------- | ----------------------------------------------------------------- |
| 협업과 유지보수 용이 | 어떤 메서드가 반드시 구현되어야 하는지 명확히 알 수 있음          |
| 기능 추가가 쉬움     | 추후 확장할 메서드를 인터페이스에 미리 선언만 해두면 구현 준비 끝 |
| 타입 안정성 확보     | 구현 클래스가 실수로 메서드를 빼먹는 걸 방지 가능                 |

---

### 어떤 구조로 만들 건가요?

- 가장 기본적인 역할: **포트에서 P2P 서버를 열기**
- 이를 위한 메서드: `listen(port: number): void`

---

### 어떻게 구현하나요?

> 파일 경로: `src/core/server/interface/p2p.interface.ts`

```ts
export interface IP2P {
  listen(port: number): void;
}
```

---

### 설명 포인트

| 항목           | 설명                                                                 |
| -------------- | -------------------------------------------------------------------- |
| `IP2P`         | 앞으로 만들 P2P 클래스는 이 인터페이스를 **반드시 구현**해야 합니다. |
| `listen()`     | 서버를 열고, 노드 간 연결을 수신할 수 있게 해주는 메서드입니다.      |
| `port: number` | 열어야 할 TCP 포트 번호입니다. 8080 같은 포트를 열게 됩니다.         |

---

### 앞으로 어떻게 쓰일까요?

- `P2P implements IP2P` 형태로 P2P 클래스가 이 구조를 따르게 됩니다.
- `listen()` 메서드는 실제로 TCP 소켓 서버를 열게 됩니다.
- 이 구조 위에 `broadcast()`와 같은 메서드를 확장해 나갈 예정입니다. (예: 트랜잭션 전파)

---

### 정리

- `IP2P`는 **블록체인 네트워크의 출발점**을 구성하는 인터페이스입니다.
- 서버를 여는 가장 기본적인 기능부터,  
  향후 **네트워크 동기화, 트랜잭션 공유, 블록 전파**까지 이 구조를 기반으로 확장될 것입니다.
