## 메시지 구조 정의하기 (`message.interface.ts`)

---

### 왜 먼저 이걸 정의할까요?

이 질문에 답하기 위해서는 먼저 **소켓의 본질**부터 이해해야 합니다.

---

### 소켓은 블록체인 기술이 아닙니다

소켓은 **TCP 위에서 작동하는 데이터 통신 도구**입니다.  
원래는 일반적인 네트워크 통신에서 많이 사용되는 구조죠.

- 내가 **무언가를 요청하지 않아도**,  
  상대방이 **직접 데이터를 전송**해줄 수 있습니다.
- 즉, **항상 열어둔 연결**을 통해  
  내가 상대방의 응답을 **수동적으로 기다릴 수도** 있고,  
  내가 먼저 **주도적으로 보낼 수도** 있는 구조입니다.

> 이것이 바로 **소켓의 핵심 본질**입니다.  
> "요청-응답"의 흐름이 아니라, **쌍방 간 실시간 통신**이 가능한 구조.

---

### 그럼 블록체인에서는 이걸 어떻게 쓸까요?

블록체인에서의 연결 구조는 단순히 "서버가 응답을 주는 구조"가 아닙니다.

- 내가 블록을 채굴하면, **내가 먼저 다른 노드에게 전달**해야 하고,
- 다른 노드가 블록을 채굴하면, **나는 별도 요청 없이 받아야** 합니다.

즉, **양쪽 모두가 언제든지 메시지를 보내고 받을 수 있는 상태**여야 합니다.

---

### 결국 이 모든 걸 묶은 것이 ‘노드’입니다

노드는 단순히 데이터를 저장하는 서버가 아닙니다.

- 요청도 하고, 응답도 받고, 메시지도 직접 보냅니다.
- 트랜잭션을 만들기도 하고, 다른 트랜잭션을 받아들이기도 합니다.
- 체인을 유지하고, 새로운 블록을 받아서 검증하기도 합니다.

이런 **복합적인 역할**을 수행하는 구조가 바로 **노드(Node)**입니다.

---

### 그래서 왜 메시지를 추상화해야 하나요?

이처럼 블록체인 노드는 언제든지 메시지를 보내고 받을 수 있어야 합니다.  
그리고 그 메시지에는 **명확한 구조와 의미**가 있어야 합니다.

예를 들어:

- “지금 내가 가진 체인의 마지막 블록이 이거야”
- “이게 새로 채굴한 블록이야”
- “네 체인 좀 보여줘”

이런 것들을 주고받기 위해, 우리는 **type**과 **payload**로 이루어진  
표준화된 메시지 구조가 필요합니다.

---

### 그래서 오늘은, 우리가 사용할 메시지 구조를 정의합니다

우리는 앞으로 아래와 같은 형태로 메시지를 주고받을 겁니다:

```json
{
  "type": "latestBlock",
  "payload": { ... }
}
```

이 구조가 모든 메시지의 **기본 단위**가 되며,  
블록체인 네트워크 전체 통신을 이 형식으로 통일할 것입니다.

---

### 어떤 구조로 만들 건가요?

1. `type`이라는 값으로 요청의 종류를 구분합니다.
2. `payload`에는 실제 데이터를 담습니다.
3. 이 둘을 묶은 `IMessage`라는 구조를 만들어서, 앞으로 주고받는 모든 메시지에 사용할 겁니다.

---

### 어떻게 구현하나요?

> 파일 경로: `src/core/server/interface/message.interface.ts`

```ts
import Block from "@core/block/block";

// 1. 요청 종류를 미리 정의합니다.
export enum MessageType {
  latestBlock = "latestBlock", // 최신 블록 요청
  allBlock = "allBlock", // 전체 블록 요청
  addBlock = "addBlock", // 새로운 블록 추가 요청
}

// 2. 메시지 구조를 정의합니다.
export interface IMessage {
  type: MessageType; // 어떤 종류의 요청인지
  payload: Block | Block[]; // 보낼 데이터 (블록 1개 또는 블록 목록)
}
```

---

### 설명 포인트

| 항목               | 설명                                                               |
| ------------------ | ------------------------------------------------------------------ | -------------------------------------------------------------------------------- |
| `enum MessageType` | 요청의 종류를 정해둔 목록입니다. 오타 없이, 자동완성도 지원됩니다. |
| `IMessage`         | 모든 메시지는 `type`과 `payload` 두 가지로 구성됩니다.             |
| `Block             | Block[]`                                                           | 블록 하나만 보낼 수도 있고, 여러 개를 보낼 수도 있기 때문에 이렇게 설정했습니다. |

---

### 앞으로 어떻게 쓰일까요?

- 클라이언트는 `type`에 맞는 메시지를 만들어 서버로 보냅니다.
- 서버는 메시지를 받으면, `type`을 기준으로 작업을 나눕니다.
- 내일 수업에서는 여기에 `"broadcastTransaction"` 같은 타입이 새로 추가됩니다.

---

### 정리

- 지금 정의하는 건 **블록체인 노드 간 통신을 위한 기본 언어**입니다.
- 소켓의 개념, 블록체인 노드의 역할을 이해했다면  
  지금 이 메시지 구조가 왜 중요한지 감이 잡히셨을 겁니다.
