# 지금까지 우리는 무엇을 해왔나요?

지금까지 우리는 **블록체인의 기본 구성 요소**를 직접 구현하며 그 흐름을 배웠습니다.

- 블록은 왜 생겼는가? → **해시**와 **머클트리**를 통해 무결성을 보장
- 타입스크립트 기반으로 구조를 **추상화**하고 **모듈화**된 방식으로 코딩
- 블록 구조를 간단히 구현하고 → **체인으로 연결**
- 나를 증명하는 방법으로 **지갑(Wallet)** 생성
- 누군가에게 돈을 보내는 방식으로 **트랜잭션(Transaction)** 생성
- 그리고 마지막으로, **채굴자 보상 트랜잭션(코인베이스)**까지 생성했죠

---

# 그런데…

**이 모든 걸 "나 혼자만" 알고 있다면?**

"내가 블록을 만들었어!"  
"내 체인이 더 길어!"  
"나는 이런 트랜잭션을 갖고 있어!"

라고 **외치지 않으면**,  
**블록체인의 탈중앙화 철학**에 완전히 위배됩니다.

> **블록체인 네트워크는,  
> 내 정보를 다른 노드들과 끊임없이 '동기화'하는 시스템**입니다.

---

# 그래서 오늘은 무엇을 배우나요?

이제 우리는 **노드 간 통신**을 위한  
**소켓 기반의 P2P 네트워크 구조**를 직접 구현합니다.

- 다른 노드에 연결하고
- 블록을 보내고
- 체인을 요청하고
- 내 체인을 상대 체인과 **비교/갱신**하는 구조

---

# 최종 목표는 무엇인가요?

**각자 실행된 노드(터미널)들이 서로 연결**되어,

- 새로 블록을 만들면 → 자동으로 다른 노드에 전달
- 다른 노드가 나보다 긴 체인을 갖고 있으면 → 내 체인을 교체
- **완전히 동기화된 블록체인 네트워크**를 만드는 것!

---

# 단계별 구현 순서

### 1단계: `node.ts` – 전체 노드 실행 구조 만들기

- HTTP 서버, P2P 서버 동시에 실행
- 상대 노드에 소켓 연결

### 2단계: `p2p.ts` – 서버 열기 및 소켓 초기화

- 서버 listen()
- 클라이언트 연결 시 초기화
- 메시지 수신 처리 (전체 블록, 최신 블록 요청 등)

### 3단계: `client.ts` – 클라이언트 역할과 블록 생성

- 특정 상황에 따라 연결 및 요청 (블록 추가, 체인 요청 등)
- 받은 응답에 따라 체인 갱신

### 4단계: `server/index.ts` – 진입점 파일이자 Express 앱과 API 통신

- 환경변수에 따라 다른 노드를 실행

### 5단계: `index.html` – 간단한 웹 인터페이스로 확인

- 블록 전체 조회
- 블록 생성
- 실시간 체인 확인

---

# 정리: 전체 흐름 요약

| 단계 | 구현 파일    | 핵심 역할                        |
| ---- | ------------ | -------------------------------- |
| 1    | `node.ts`    | HTTP + P2P 서버 실행, 연결 시작  |
| 2    | `p2p.ts`     | 연결 요청 수신, 메시지 응답 처리 |
| 3    | `client.ts`  | 연결 요청 발신, 블록 생성/요청   |
| 4    | `index.ts`   | 진입점에서 NODE_ID 기반 실행     |
| 5    | `index.html` | 웹 UI로 상태 확인 및 체험        |
