> "서비스를 배포할 때,  
> 수많은 사용자들과 소켓 연결을 동시에 유지하려면  
> 도대체 포트를 어떻게 관리하지?  
> 사용자마다 포트를 따로 열어야 하는 거야?"

이게 헷갈리는 건 **"소켓 = 포트"라고 착각하고 있기 때문**이야.  
지금 이걸 완전히 뚫어주면,  
**웹소켓 기반 실시간 서비스가 어떻게 구성되는지**까지 감이 팍 잡힐 거야.

---

# 먼저 핵심 질문 정리

> 하나의 서비스를 배포하고 소켓 연결을 하려고 하면,  
> 포트 번호는 하나일 텐데…  
> 사용자 수만큼 포트를 다 따로 열어야 하나요?

---

## 아니요! 포트는 **하나만 씁니다.**

> 사용자 수가 10명, 1000명, 100만 명이더라도  
> **서버는 소켓 포트를 단 하나만 열어놓습니다.**

예를 들면:

```ts
server.listen(8080); // WebSocket 서버
```

→ **오직 8080 포트 하나만 열려 있어요.**

근데 동시에 수천 명의 사용자가 들어오잖아요?

그럼 어떻게 되냐면…

---

## 포트는 하나, 연결은 수천 개 — 비밀은 **소켓의 구조**에 있어요

TCP 소켓은 내부적으로 이렇게 구성돼요:

```
[클라이언트 IP:클라이언트 포트] <====> [서버 IP:서버 포트]
```

즉, 연결 단위는 **"IP + 포트의 쌍"으로 구분**돼요.

### 예시:

| 사용자   | 연결 정보                               |
| -------- | --------------------------------------- |
| 사용자 A | `192.168.1.5:51123` → `wine.co.kr:8080` |
| 사용자 B | `192.168.1.6:51124` → `wine.co.kr:8080` |
| 사용자 C | `192.168.1.7:51125` → `wine.co.kr:8080` |

- 서버는 단 **하나의 포트 (8080)** 만 열고 있고,
- **각 사용자는 자신의 고유 포트를 자동으로 할당받아서 연결**해요.

이걸 **"소켓 연결은 양방향 포트쌍으로 구분된다"**고 해.

---

## 정리하자면

| 오해                             | 실제 작동 방식                                                        |
| -------------------------------- | --------------------------------------------------------------------- |
| 사용자가 많으면 포트가 늘어난다? | ❌ 포트는 하나, **연결만 많아지는 것**                                |
| 포트는 사용자 단위로 할당되나?   | ❌ 서버는 포트 1개, **클라이언트 측이 임시 포트를 자동 배정**         |
| 그럼 어떻게 구분하죠?            | ✅ `클라이언트 IP + 클라이언트 포트` ←→ `서버 IP + 서버 포트` 로 구분 |

---

## 그래서 개발자가 할 일은?

- 그냥 WebSocket 서버를 `server.listen(8080)` 처럼 하나만 열고,
- 나머지는 Node.js나 WebSocket 라이브러리가 **자동으로 사용자 소켓을 구분해서 관리**해줘.

너는 이렇게만 하면 돼:

```ts
wss.on("connection", (socket) => {
  socket.send("반갑습니다!");
});
```

---

## 한 문장 정리

> **소켓 연결은 “하나의 포트를 통해 수천 명과 동시 연결”이 가능하다.**  
> 사용자마다 포트를 따로 열 필요 없고,  
> 서버는 하나의 포트만 열고, 내부적으로 “소켓 ID”로 모든 연결을 구분합니다.
