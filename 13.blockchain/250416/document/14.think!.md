# `p2p.ts` – 메시지를 받는 코드가 아니라, “노드의 문을 여는 코드”

## 학생들이 흔히 하는 오해

> “`p2p.ts`는 그냥 `on("data")`로 메시지를 받는 코드 아닌가요?”

아니야. 그건 절반만 맞는 말이야.

## 정확하게 말하면

> `p2p.ts`는 단순히 메시지를 수신하는 코드가 아니라,  
> **소켓 서버를 열고, 그 서버에 연결된 모든 노드와 지속적인 관계를 유지하는 구조**야.

### 즉, **노드가 ‘서버 역할’을 수행하는 진짜 주체**가 바로 이 파일이야.

## 역할을 명확히 정리하면

| 역할                   | 설명                                                                    |
| ---------------------- | ----------------------------------------------------------------------- |
| 1. 소켓 서버 열기      | 다른 노드가 내게 연결할 수 있도록 `listen(port)`으로 **문을 열어둠**    |
| 2. 연결된 소켓 추적    | 누가 나에게 연결했는지 **sockets 배열에 저장**해서 추적 가능            |
| 3. 메시지 수신 및 처리 | 상대 노드가 보낸 메시지를 `socket.on("data")`로 받고 → 타입에 따라 처리 |
| 4. 연결 종료 관리      | 연결이 끊겼을 때 소켓을 **배열에서 제거**해주는 역할도 포함됨           |

---

> “블록체인 네트워크는 모두가 서버입니다.
>
> 그래서 각 노드는 **자기만의 소켓 서버**를 열고,  
> 다른 노드들이 내게 연결할 수 있도록 항상 **문을 열어둬야** 합니다.”
>
> 이 역할을 맡는 파일이 바로 **`p2p.ts`**예요.
>
> 단순히 메시지를 수신하는 게 아니라,  
> **“나는 노드입니다. 연결할 수 있어요. 들어오세요”** 하고 **연결을 받아들이는 역할**까지 포함합니다.

---

## 한 줄 요약

> `p2p.ts`는 단순 수신기가 아니라  
> **소켓 서버를 열고, 연결을 수락하고, 메시지를 실시간으로 받아들이는**  
> 블록체인 노드의 핵심 엔트리 역할을 합니다.
