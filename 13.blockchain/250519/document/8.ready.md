# 실습 시작 전 – 환경 준비 및 일정 안내 (수정판)

이제부터 우리는 본격적으로
**계정 추상화 구조(Account Abstraction)**를 직접 구현하는 실습에 들어갑니다.

하지만 그 전에!
환경을 세팅하고, 우리가 무엇을 어떻게 구현할지를 **전체 흐름 기준으로 이해**해야 합니다.

## 디렉토리 구조 한눈에 보기

우리가 작업할 실습 디렉토리는 다음과 같이 구성되어 있습니다:

```
8.metaTransaction
├─ ERC4337.json                  ← 실제 트랜잭션 구조 분석용 샘플
├─ README.md                    ← 수업 전체 설명 파일
└─ meta/                        ← 우리가 직접 실행할 실습 프로젝트 폴더
   ├─ README.md
   ├─ package.json              ← 필요한 모듈 목록
   ├─ public/                   ← React 기본 static 파일
   └─ src/
      ├─ App.js                 ← 프론트엔드 핵심 로직 (2일차 구현)
      ├─ api/server.js          ← 백엔드 서버 (txpool 처리, 실행자 역할 – 2일차 구현)
      ├─ contracts/
      │  ├─ myToken.sol         ← 실습용 토큰 컨트랙트
      │  ├─ metaTransaction.sol ← 메타 트랜잭션 처리 컨트랙트
      │  └─ artifacts/          ← 컴파일된 ABI + 메타데이터
      ├─ hooks/userEthers.js    ← 서명 전용 사용자 지갑 10개 생성용 훅
      └─ index.js               ← React 진입점
```

## 모듈 설치 및 환경 구성

```bash
cd 8.metaTransaction/meta
npm install
```

위 명령으로 필요한 모듈을 설치합니다.
`ethers`, `express`, `axios`, `cors` 등이 포함되어 있으며
→ 프론트와 백엔드 간 서명 전달 및 실행을 위한 핵심 도구입니다.

## 전체 흐름 다시 보기 (EntryPoint 기반 구조)

```
[사용자 지갑]
    ↓ signMessage()

[프론트엔드]
    ↓ POST

[백엔드 txpool]
    ↓ /metaTransaction

[회사 지갑 (Bundler)]
    ↓

[스마트 컨트랙트 mint()]
```

이 구조는 우리가 **EIP-4337에서 봤던 구조**를
**직접 손으로 구현하고 시뮬레이션하는 실습 목표**입니다.

## 실습 진행 순서 정리

| 순서 | 파일                            | 설명                                                  |
| ---- | ------------------------------- | ----------------------------------------------------- |
| 1    | `contracts/metaTransaction.sol` | 핵심 스마트 컨트랙트 – 실행/검증 로직 구현 대상       |
| 2    | `hooks/userEthers.js`           | 사용자 서명 지갑 10개 생성. 테스트를 위한 signer 준비 |
| 3    | `server.test.js`                | 서명 → 검증 → 실행까지 흐름을 TDD로 구현 및 검증      |
| 4    | `App.js`, `server.js`           | (2일차) 실제 사용자 입력 → 서명 → 전송 구조 구현      |
| 5    | `ERC4337.json`                  | 우리가 구현한 구조와 실제 EntryPoint 구조 비교용 샘플 |

## 실습 일정 구분 (변경 사항 반영)

---

### 5월 19일 (1일차): 흐름 체화 중심 – 서버/화면 없음

> 오늘은 오직 **코드 기반 흐름만 체화**합니다.
> 서버도 화면도 없습니다. 오직 TDD.

### 오늘의 목표

- 계정 추상화가 가능해지는 실행 구조를 **테스트 코드로 직접 구현**
- 사용자는 **signMessage()로 요청만 남기고**,
- 회사 지갑은 **그 요청을 검증하고 실행**합니다
- 이 구조가 정말로 가능한지를 손으로 확인

---

| 구현 흐름   | 설명                                              |
| ----------- | ------------------------------------------------- |
| 지갑 생성   | `generateWallets()`로 signer 준비                 |
| 메시지 생성 | `{ sender, data }` 객체 구조                      |
| 서명        | `signMessage()`를 사용한 ECDSA 서명               |
| 검증        | `verifyMessage()`와 `ecrecover()` 구조 연결 확인  |
| 실행        | 컨트랙트의 `mint()` 호출 → 서명 검증 후 토큰 지급 |

---

### 5월 20일 (2일차): 사용자 UI + 서버 API 구현

> 1일차에 손으로 체화한 구조를
> **화면(UI)과 서버(API)**로 연결하는 작업입니다.

### 내일의 목표

- 사용자가 웹에서 입력 후 버튼을 눌러 서명하고,
- 서버가 `/sign`에서 서명 검증 → 저장하고,
- `/metaTransaction`에서 실행하는 전체 흐름을 **시각적으로 체험**

---

| 구성 요소             | 설명                                                                      |
| --------------------- | ------------------------------------------------------------------------- |
| 프론트엔드 (`App.js`) | 사용자 지갑 선택, 메시지 입력, signMessage(), axios 전송                  |
| 서버 (`server.js`)    | `/sign`: 서명 검증 및 txpool 저장<br>`/metaTransaction`: 저장된 요청 실행 |
| UX 흐름               | 사용자는 **트랜잭션을 서명만**, 실행은 **회사 지갑이 처리**               |

## 최종 정리

| 날짜         | 주요 작업                                                | 목표                                                 |
| ------------ | -------------------------------------------------------- | ---------------------------------------------------- |
| **5월 19일** | `metaTransaction.sol`, `userEthers.js`, `server.test.js` | 코드 흐름 기반 TDD 구현 (서버/화면 없음)             |
| **5월 20일** | `App.js`, `server.js` 연결                               | 사용자 요청 → 실행까지 전체 흐름 완성 (UI 기반 실행) |

## 이제 시작합니다

**`metaTransaction.sol`을 완성하고**,
서명된 요청을 **어떻게 검증하고 실행하는지**
직접 코드를 따라가며 만들어보겠습니다.
