# 잠깐, EIP-155?

여러분,  
우리는 방금 ERC-4337 구조의 다섯 가지 핵심 요소를 배웠습니다.  
UserOperation, Bundler, EntryPoint, Paymaster, EIP-1271…

그런데 갑자기 새로운 구조가 나오니까  
이런 질문이 생길 수 있습니다.

> “근데 원래 Ethereum의 트랜잭션 구조는 어땠죠?”
> “그 전에는 이런 구조가 없었나요?”
> “왜 새로운 걸 만들었나요?”

맞습니다.  
우리가 지금 배우고 있는 건 **기존 Ethereum 구조를 ‘대체’하려는 구조**입니다.  
그렇다면 기존 구조가 **어떻게 생겼는지를 먼저 짚고 넘어가야 합니다.**

Ethereum의 기본 트랜잭션 구조는  
**EIP-155**라는 제안에서 정리되어 있습니다.

> 이게 우리가 지금까지 당연하게 써왔던 **"일반적인 트랜잭션"**입니다.

## 그럼, EIP-155는 무엇인가?

EIP-155는 2016년에 등장한 제안서로,  
Ethereum의 **트랜잭션 서명 구조를 정의한 표준**입니다.

이 제안서가 등장한 이유는 다음과 같습니다:

- 과거에는 서명에서 체인 ID가 구분되지 않아
  → Replay Attack(다른 체인에서 서명 복사하여 실행)이 가능했음
- 이를 막기 위해 트랜잭션 서명 구조에 **체인 ID**를 추가

EIP-155 기반 트랜잭션 구조는 아래처럼 구성됩니다:

```
{
  nonce: 0,
  gasPrice: 1000000000,
  gasLimit: 21000,
  to: "0x1234...",
  value: 1 ETH,
  data: "0x...",
  chainId: 1,
  v: ...,
  r: ...,
  s: ...
}
```

- **v, r, s**: ECDSA 서명 파라미터 (누가 보냈는지를 증명)
- 이 서명이 있어야만 **트랜잭션은 유효**하다고 인정됨

즉, **누가 보냈는가?**를 증명하는 방식이
항상 ECDSA 개인 키 서명으로 고정되어 있었던 겁니다.

그런데 여기서 바로 문제가 생깁니다.

## 구조적 문제: “계정이 서명만 해야 한다고 누가 정했나요?”

- 트랜잭션 = 서명 + 전송
- 서명 = 무조건 개인 키
- 계정 = 서명 가능한 주소(EOA)

이 구조 안에서는 **절대로 컨트랙트가 계정처럼 행동할 수 없습니다.**

---

> “이 구조는 너무 고정적이다.”
> “우리는 컨트랙트에도 로직을 넣고 싶고, 서명 방식도 유연하게 바꾸고 싶다.”
> “그런데 이 고정된 구조(EIP-155) 때문에 아무 것도 못 한다.”

---

그래서 나온 생각이 바로 이겁니다:

> “아예 새로운 구조의 트랜잭션 객체를 만들자.”
> “기존 트랜잭션 풀에 들어가지 않고,
> **우리가 따로 처리할 수 있는 구조**를 만들자.”

그 결과물이 바로

## **UserOperation**

- UserOperation은 더 이상
  `v, r, s`로 서명하지 않아도 됩니다.
- 서명 방식도 자유롭게 커스터마이징할 수 있습니다.
- 계정이 컨트랙트든 사람이든 **상관없이 요청을 보낼 수 있습니다.**

---

정리하면

| 구분          | EIP-155 트랜잭션 | ERC-4337 UserOperation     |
| ------------- | ---------------- | -------------------------- |
| 서명 방식     | 고정 (ECDSA)     | 자유롭게 정의 가능         |
| 계정          | EOA만 가능       | 스마트 계정(컨트랙트) 가능 |
| 트랜잭션 위치 | 기본 mempool     | 별도의 UserOp pool         |
| 실행 방식     | 바로 체인에 포함 | Bundler → EntryPoint 경유  |

## 왜 이 단락이 필요했을까?

우리가 앞으로  
handleOps, signMessage, validateUserOp 같은 코드를 다룰 때  
“아니, 이건 트랜잭션도 아닌데 어떻게 실행이 되지?”  
라는 의문이 들 수 있습니다.

그걸 이해하려면  
“아, 원래 트랜잭션은 이렇게 생겼는데,  
ERC-4337은 구조 자체를 다르게 만든 거구나”  
라는 **기준점(EIP-155)**을 알고 있어야 하는 겁니다.

---

이제 기존 트랜잭션 구조와의 차이를 확실히 이해했으니,
우리는 다음으로
**UserOperation이 실제로 어떻게 만들어지고 검증되는가**
즉, **실제 흐름을 따라가는 구현 파트**로 넘어갈 수 있습니다.
