# 실습: `replaceChain()` 테스트 코드 작성하기

## 목표

지금까지 우리는 블록을 생성하고, 체인에 추가하는 기능을 만들었습니다.  
이제는 **내 체인을 다른 체인과 비교해서 교체할 수 있는지**를 판단하는 기능,  
즉 `replaceChain()`을 **테스트 코드로 검증**해보겠습니다.

---

## replaceChain이란?

이 메서드는 **다른 노드에서 받은 체인**을  
**현재 내가 갖고 있는 체인과 비교해서**,  
**더 길면 교체하고**, 그렇지 않으면 무시하는 기능이에요.

> 실생활로 비유하면,  
> "내가 갖고 있는 기록보다 더 긴 기록이 들어오면 → 그걸 믿고 덮어쓰기"  
> 라고 생각하면 됩니다!

---

## 실습 시작

### 1단계: 테스트 환경 구성

먼저 `Chain`, `Block`, `GENESIS`를 불러옵니다.

```ts
import Chain from "@core/chain/chain";
import Block from "@core/block/block";
import { GENESIS } from "@core/config";
```

---

### 2단계: 테스트 그룹 선언

`describe()`를 이용해서 테스트 그룹을 만들어주세요.

```ts
describe("replaceChain 테스트", () => {
  let myChain: Chain;
  let otherChain: Chain;

  beforeEach(() => {
    myChain = new Chain();      // 내가 갖고 있는 체인
    otherChain = new Chain();   // 상대방이 보내온 체인
  });

  ...
});
```

이제 안쪽에 각각의 테스트를 만들어볼게요.

## 테스트 1: 상대 체인이 제네시스 블록만 있을 경우

**기대 결과**: 너무 짧기 때문에 교체되지 않아야 합니다.

```ts
it("1. 상대 체인이 제네시스 블록만 있을 경우 → 교체하지 않음", () => {});
```

## 테스트 2: 상대 체인이 내 체인보다 짧거나 같을 경우

**시나리오**:

- 내 체인에 블록 하나 추가
- 상대 체인은 Genesis만 있음

```ts
it("2. 상대 체인이 내 체인보다 짧거나 같을 경우 → 교체하지 않음", () => {});
```

---

## 테스트 3: 상대 체인이 더 길 경우

**시나리오**:

- 상대 체인에 블록 2개 추가
- 내 체인은 여전히 제네시스 블록만 있음

```ts
it("3. 상대 체인이 더 길 경우 → 체인 교체", () => {});
```

---

## 전체 요약

| 테스트   | 설명                                    |
| -------- | --------------------------------------- |
| 테스트 1 | 상대방 체인이 너무 짧아서 교체하지 않음 |
| 테스트 2 | 내 체인이 더 길어서 교체하지 않음       |
| 테스트 3 | 상대 체인이 더 길어서 교체 성공         |

---

## 마무리

이번 실습은 단순히 테스트 코드를 작성하는 게 아니라,  
**"블록체인이 어떻게 서로 다른 체인을 비교하고 선택하는가"**를  
몸으로 익히는 과정이에요.

> 핵심은: **가장 길고, 신뢰 가능한 체인을 선택한다**는 것!
