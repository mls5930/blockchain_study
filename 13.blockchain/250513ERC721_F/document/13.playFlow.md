## 전체 실행 흐름 – 유저 플로우 관점으로 보기

자, 여러분.
지금까지는 우리가 **기능별로 쪼개서 구현하는 흐름**을 배웠습니다.

- mint는 어떻게 하지?
- approve는 왜 필요한가?
- purchase는 어떻게 작동하는가?

이제는 그것들을 **한 줄로 엮어서**,
**사용자 입장에서 이 프로젝트가 어떤 순서로 동작하는지**를 정리해보겠습니다.

---

### 시나리오 가정

- 계정은 **두 개만 사용**한다고 가정합니다.

  - 계정 1: 판매자
  - 계정 2: 구매자

(물론 계정이 몇 개든 상관은 없지만, 수업의 흐름상 단순화를 위해 이렇게 설정합니다.)

## 실행 흐름 전체 정리

---

### 1. 계정 1이 스마트 컨트랙트를 Remix에서 **배포**한다

- 이때 `BaseballNFT.sol` 내부의 `owner`는 계정 1이 됩니다.
- 이 구조는 우리가 수업에서 설계한 것이며,
  → **minting 권한을 오직 owner만 가지도록 설정**되어 있습니다.

> ⚠️ 주의:
> 이게 “정답”이라는 뜻은 아닙니다.
> **이건 교강사가 실습 시나리오를 만들기 위해 고안한 흐름입니다.**
> 여러분도 프로젝트를 설계할 땐,
> **누가 mint를 할 수 있어야 하는지** 반드시 스스로 고민해서 결정해야 합니다.

---

### 2. 계정 1이 본인에게 NFT를 **minting**한다

```ts
minting(0);
```

- tokenId = 0
- 내부적으로 `tokenURI(0)`은 `"ipfs://.../0.json"`을 반환하도록 되어 있음

> 이때 중요한 건,
> **tokenId와 메타데이터 파일이 일치하도록 업로드되어 있어야 한다는 점입니다.**

---

### 3. 계정 1이 자신의 NFT를 **판매 상태로 등록**한다

화면에서 "내 NFT 보기" → "판매하려고 내놓기" 버튼을 클릭합니다.

내부적으로는 다음 함수가 실행됩니다:

```ts
approve(contractAddress, tokenId);
```

> 이 단계에서 Metamask 서명이 뜨며,
> **내 NFT를 해당 스마트 컨트랙트가 대신 전송할 수 있도록 권한을 위임**합니다.

이 작업을 하지 않으면 → 구매자가 사려고 해도 전송이 되지 않습니다.

---

### 4. 계정 2로 Metamask 계정을 전환한다

- 이제 구매자로 전환합니다.
- `useEffect`에서 자동으로 web3 인스턴스를 초기화하므로
  지갑을 바꾸고 "🦊 메타마스크 지갑 연결" 버튼을 다시 눌러야 합니다.

---

### 5. 계정 2가 화면에서 **전체 NFT 조회** 버튼을 클릭한다

```tsx
loadAllNFTs();
```

- 이 함수는 전체 tokenId를 불러와서

  - 각 tokenId의 owner,
  - `tokenURI`,
  - 이미지 등
    → 모든 NFT 정보를 화면에 출력합니다.

---

### 6. 계정 2는 구매할 수 있는 NFT에 **🛒 구매하기 버튼**이 보인다

```tsx
{
  nft.owner.toLowerCase() !== account.toLowerCase() && (
    <button onClick={() => purchaseNFT(nft.tokenId)}>🛒 구매하기</button>
  );
}
```

- 내 계정이 소유한 NFT는 구매할 수 없기 때문에 버튼이 안 보입니다.
- 계정 2는 계정 1이 가진 NFT에만 구매 버튼을 볼 수 있습니다.

---

### 7. 계정 2가 구매 버튼을 클릭한다

```ts
purchase(tokenId);
```

- 내부적으로는 `1 ether`를 첨부하여 `purchase()` 함수 호출
- 컨트랙트는 `msg.value`를 판매자에게 전송
- `transferFrom(owner → buyer)`로 소유권 이전

> 이로써 **NFT는 계정 2의 소유**가 됩니다.

---

## ✅ 전체 요약 – 흐름 정리 표

| 단계 | 행동 주체       | 함수/버튼           | 설명                |
| ---- | --------------- | ------------------- | ------------------- |
| 1    | 계정 1          | Remix 배포          | owner 설정됨        |
| 2    | 계정 1          | `minting(0)`        | NFT 발급            |
| 3    | 계정 1          | "판매하려고 내놓기" | approve 실행        |
| 4    | 계정 2          | 지갑 전환           | 구매자 모드 진입    |
| 5    | 계정 2          | "전체 NFT 보기"     | 모든 tokenId 확인   |
| 6    | 계정 2          | "🛒 구매하기"       | 구매 요청 실행      |
| 7    | 스마트 컨트랙트 | `purchase()` 내부   | ETH 전송 + NFT 이전 |

## 마무리

> 여러분,
> 이게 바로 단순 NFT 발급이 아니라
> **NFT를 사고파는 실제 "거래 구조" 전체 흐름**입니다.

여기까지 따라오셨다면,

- NFT가 단순 이미지가 아니라 어떤 흐름을 가지는 자산인지
- 누구의 권한이 필요한지
- 어떤 순서로 동작해야 에러 없이 트랜잭션이 처리되는지

→ 완전히 체감하셨을 겁니다.
