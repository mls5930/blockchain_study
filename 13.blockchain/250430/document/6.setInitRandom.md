# **첫 번째 목표: 게임을 실행해보자 — random을 만들자**

## 게임을 실행하려면 "정답"이 필요하다

Baseball 게임을 시작하려면,  
**가장 먼저 해야 할 일**이 있습니다.

"**컴퓨터가 몰래 정답을 정해두는 것**"입니다.

이 정답은 아무나 쉽게 예측할 수 없어야 합니다.  
만약 누군가 정답을 미리 알아버린다면,

- 게임은 무의미해지고
- 시스템 전체가 신뢰를 잃게 됩니다.

---

그래서 우리는 **완전히 무작위적인(random)** 정답 숫자를 만들어야 합니다.

## 근데, 그냥 무작위(random)라고 하면 끝일까요?

절대 그렇지 않습니다.

"**무작위로 보이지만, 사실은 규칙적인 패턴이 있으면?**"  
→ 해킹이나 조작이 가능해집니다.

따라서,  
**완벽하게 무작위처럼 보이는 값을 만들어야 합니다.**

이때 필요한 게 바로 **암호화 해시 알고리즘**입니다.

## **keccak256 알고리즘이란 무엇인가?**

이더리움 스마트 컨트랙트에서는  
**keccak256**이라는 해시 함수를 사용합니다.

- **입력값이 아주 조금만 달라져도**
- **출력값(해시 결과)은 완전히 달라집니다.**

**즉, keccak256은 무작위성을 만들어내는 데 매우 유용한 도구입니다.**
=> 무작위성 즉 해킹을 방지하도록 무작위 해시 값을 만들어서, 유추할 수 없게끔 한다

- keccak256은 입력값을 정해진 규칙 없이 무작위처럼 변환해준다.
- 해커도 예측할 수 없는 결과를 만들어준다.

## **그럼, 무엇을 keccak256에 넣어야 할까?**

무작위한 값을 만들기 위해서는  
**변할 수 있는 정보**들을 섞어야 합니다.

- `block.timestamp` → 블록이 생성된 시간
- `block.prevrandao` → 이전 블록의 난수값
- `block.coinbase` → 블록을 만든 노드 주소
- `block.number` → 현재 블록 번호

이런 것들은  
**매번 달라지는 값**이기 때문에  
입력값으로 사용하면 해킹이 거의 불가능해집니다.

---

하지만 문제는 있습니다.

- 여러 개의 데이터를 하나로 묶어야 합니다.
- 그냥 이어붙이는 건 안 됩니다. (binary safe하게 다뤄야 함)

**그래서 필요한 게 바로 ABI 인코딩입니다.**

## **abi.encodePacked가 왜 필요한가?**

Solidity에서는

- 여러 데이터를 하나로 안전하게 묶어서
- keccak256 같은 함수에 넣을 수 있도록

**ABI 인코딩(abi.encodePacked)**이라는 기능을 제공합니다.

---

즉,

```solidity
abi.encodePacked(block.timestamp, block.prevrandao, block.coinbase, block.number)
```

이렇게 사용하면,

- 시간
- 난수값
- 채굴자 주소
- 블록 번호

이 네 가지 정보를 하나의 뭉친 데이터로 만들 수 있습니다.

이걸 keccak256에 넣으면  
완전히 새로운, 누구도 예측할 수 없는 무작위 결과를 얻을 수 있습니다.

## **그 다음: 랜덤 숫자를 3자리 숫자로 맞춰야 한다**

keccak256은  
**아주 긴 16진수 숫자**를 만들어냅니다.  
(예: `0x54fa9b3d62...` 이런 식)

1010020020030300.....
그런데 우리 게임은  
**100~999** 사이의  
310
333
259
555
666....
**딱 3자리 숫자**만 필요합니다.

그래서 추가로 수식을 하나 적용합니다.

```solidity
random = (random % 900) + 100;
```

- `random % 900` → 0부터 899까지 숫자로 만든 다음
- `+ 100` → 100부터 시작하는 3자리 숫자로 변환합니다.

이렇게 하면 항상  
**100 이상 999 이하**의 숫자가 나옵니다.

## 최종적으로 random을 만드는 코드

```solidity
random = uint256(
    keccak256(
        abi.encodePacked(
            block.timestamp,
            block.prevrandao,
            block.coinbase,
            block.number
        )
    )
);

random = (random % 900) + 100;
```

## 흐름 요약

| 단계 | 설명                                                            |
| ---- | --------------------------------------------------------------- |
| 1    | keccak256으로 예측 불가능한 해시값 생성                         |
| 2    | block.timestamp, prevrandao, coinbase, number를 입력값으로 사용 |
| 3    | abi.encodePacked로 안전하게 묶어서 keccak256에 입력             |
| 4    | 나온 결과를 900으로 나눈 나머지에 100을 더해 3자리 숫자로 변환  |
| 5    | 최종 결과를 random 변수에 저장                                  |

## 중요한 점

- 무작위처럼 보이는 값도 **정확한 이유와 방법을 거쳐 만들어야 한다.**
- 블록체인 네트워크에 이미 존재하는 다양한 변수들을 활용해야 한다.
- 스마트 컨트랙트에서는 **단순한 난수 생성이 아니라, 해시 기반 난수 생성**을 기본으로 삼아야 한다.
- random 생성 과정은 단순한 숫자 뽑기가 아니라  
  **네트워크 데이터를 활용해 안전한 난수**를 만드는 과정이다.
- abi.encodePacked, keccak256, block 변수들은 모두 필수적인 이유가 있다.
- 이렇게 만든 random을 통해 게임의 신뢰성을 보장할 수 있다.
