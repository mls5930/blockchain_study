# 머클 트리 실습: 해시를 쌓아 만든 트리 구조

해당 실습 파일 명은 src/murkleroot.ts입니다.

## 해당 실습 목표

- 해시가 아닌 여러 개의 데이터에 어떻게 적용되는지 보기
- 머클 트리(Merkle Tree)가 어떻게 구성되었는지 직접 실습해보기.
- 최종 결과인 머클 루트(Merkle Root)를 구하기

## 설치 및 코드 작성

### 1. `merkle` 라이브러리 설치

```bash
npm init -y
npm install merkle
```

- `merkle.js` 라이브러리를 프로젝트에 설치합니다.
- 머클 트리를 쉽게 생성할 수 있는 유틸을 제공함.
- 설치 후 다음과 같은 메시지가 출력됨:

```
added 5 packages, and audited 26 packages in 2s

3 critical severity vulnerabilities
```

### 2. 머클 트리 실행

```bash
node src/murkleroot.js
```

### 3. 실행 결과 출력

```bash
AE4F3A195A3CBD6A3057C205DEF94520930F03F51F73C5A540D8FDAB05163FEF
```

- 출력된 문자열은 **머클 루트 해시값**입니다.
- `txData = ["A", "B", "C", "D", "E"]` 를 기반으로 SHA-256 해시 알고리즘을 통해 생성된 루트
- **이 값 하나만으로 해당 데이터들이 변조되지 않았음을 검증할 수 있음**

## 전체 코드

```ts
const merkle = require("merkle");

const txData = ["A", "B", "C", "D", "E"];

const merkleTree = merkle("sha256").sync(txData);
const Root = merkleTree.root();
console.log(Root);
```

---

### 1. merkle 모듈이란?

이 코드는 merkle.js라는 라이브러리를 사용하고 있음

- 머클 트리를 쉽게 만들 수 있도록 도와주는 패키지
- sync(data) 메서드를 사용하면 트리를 자동으로 구성해줍니다.
- 내부적으로 각 데이터를 SHA-256 해시로 바꾸고, 트리를 구성해서 루트 값을 계산해줍니다.

---

### 2. txData = 트랜잭션 모음? (쟤 하버드 맞음!의 모음)

```ts
const txData = ["A", "B", "C", "D", "E"];

- 이 배열은 실제 블록체인의 거래 목록(Transaction List)에 해당해요.
- 여기서는 "A", "B" 등 간단한 문자열이지만, 실제로는 거래 데이터가 들어갑니다.
```

---

### 3. 트리를 만드는 과정

```ts
const merkleTree = merkle("sha256").sync(txData);
```

이 코드는 다음과 같은 단계를 자동으로 수행합니다

#### **1단계. 각각의 데이터를 해시화**

```sh
A → H1
B → H2
C → H3
D → H4
E → H5
```

#### **2단계. 짝지어서 해시값을 다시 해시**

```sh
H12 = 해시(H1 + H2)
H34 = 해시(H3 + H4)
H5는 짝이 없으므로 H5 + H5 → 해시(H5 + H5)
**홀수 개일 경우** → 마지막 값을 **자기 자신과 다시 묶음**
```

#### **3단계. 위 결과들을 또 다시 짝지어서 해시**

```sh
H1234 = 해시(H12 + H34)
H55 = 해시(H5 + H5) → H5_2
```

## → 최종 머클 루트 = 해시(H1234 + H5_2)

### 4. 루트 해시값 얻기

```ts
const Root = merkleTree.root();
console.log(Root);
```

- 이 출력값이 바로 **Merkle Root**, 최종 루트 해시입니다.
- **트랜잭션 데이터가 전혀 변조되지 않았음을 하나의 값으로 증명하는 역할**을 합니다.
- 트리의 최상단에 있는 이 해시값 하나만 보면, 전체 데이터의 정합성을 검증할 수 있어요.

## "만약 'A'라는 트랜잭션을 살짝 바꾼다면, 머클 루트는 어떻게 될까?"

우리가 사용하는 데이터 배열은 다음과 같습니다:

```ts
const txData = ["A", "B", "C", "D", "E"];
```

이 다섯 개의 거래 데이터를 바탕으로 **머클 트리**를 구성하면,
최종적으로 하나의 해시값 — 즉, **머클 루트**가 출력됩니다.

```sh
AE4F3A195A3CBD6A3057C205DEF94520930F03F51F73C5A540D8FDAB05163FEF;
```

- 'A' → 'AA'처럼 사소한 변경 하나만 있어도
- 머클 루트는 완전히 달라집니다
- 블록체인은 이 구조를 활용해 모든 거래의 정합성을 보호합니다

### 그런데… 'B'를 'BB'로 바꿔보면?

```ts
const txData = ["AA", "B", "C", "D", "E"];
```

오직 하나의 값만 바뀌었습니다.  
그런데 놀랍게도 **머클 루트는 완전히 달라집니다.**

```sh
F975ABA86C824340CE6840D9C41BA4653B87BE04E97B5D826113DDF51C3B9AE6
```

단 **한 글자만 바꿨을 뿐인데**,  
전체 루트 해시가 완전히 다른 값이 되었습니다.

머클 루트가 달라졌다면, 아래 어딘가의 데이터가 조작되었다!"  
**모든 거래 기록이 조작되지 않았다는 걸 ‘딱 하나의 값’으로 증명**

## 한 줄 요약

머클 트리는 "데이터 하나 바뀌면, 전체가 바뀐다"는 원칙 위에 만들어진 **진실 검증기계**
