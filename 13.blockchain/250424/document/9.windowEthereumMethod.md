## 정말 중요한 개념 하나만 먼저 짚고 가자

우리가 앞에서 이런 코드를 작성했죠?

```js
await window.ethereum.request({ method: "eth_requestAccounts" });
```

이 한 줄 덕분에,  
→ 메타마스크가 팝업을 띄워주고  
→ 사용자가 지갑을 연결하고  
→ 그 주소를 코드에서 받아올 수 있었습니다.

근데 이게 도대체 뭘까요?

## window? 그거 우리가 아는 그 window야?

맞아요.  
`window`는 웹 브라우저 환경에서 **전역 객체(global object)**입니다.  
쉽게 말해서, **브라우저가 우리한테 제공해주는 기능 모음**이라고 생각하면 됩니다.

예를 들어:

- `window.document` → DOM 접근 (HTML 조작)
- `window.location` → 현재 URL 정보
- `window.alert()` → 알림창 띄우기

그럼 `window.ethereum`은 뭐죠?

## 브라우저에 갑자기 ethereum 객체가 생긴 이유는?

> 이건 우리가 설치한 메타마스크 덕분입니다.

메타마스크는 **브라우저 확장 프로그램(extension)**입니다.  
크롬이나 브레이브 같은 브라우저에 설치되면,  
→ 브라우저 내부에 자동으로 다음 객체를 만들어줍니다:

```js
window.ethereum;
```

즉, **메타마스크가 웹사이트와 지갑을 연결해주기 위해**  
→ 브라우저 안에 `ethereum`이라는 **인터페이스 객체를 삽입**해준 거예요.

## 그럼 왜 굳이 이렇게 넣었을까?

여기엔 단순한 기술 구현을 넘어선, **분명한 철학적·기술적 배경**이 있어요.

## 자, 먼저 순서를 다시 정리해볼까요?

- **브라우저가 먼저입니다.**
- 그 위에 우리가 HTML, CSS, JS로 만든 웹페이지가 뜹니다.

그럼 질문!

> 브라우저는 원래부터 지갑과 연결할 수 있었을까요?

절대 아닙니다.

## 브라우저의 역할은 "웹"에만 충실합니다

- 브라우저는 기본적으로 `HTTP`, `HTTPS`, `WebSocket` 같은 **웹 통신 프로토콜**을 처리합니다.
- 그리고 웹사이트를 구성하는 `DOM`, `BOM`, `window`, `document` 등의 **웹 API 객체들**을 제공하죠.

즉, **브라우저는 "웹 페이지를 보여주는 기계"이지,  
블록체인 네트워크와 대화하거나, 지갑을 연결하거나, 서명을 수행할 수 있는 도구가 아닙니다.**

## 근데 Web3 시대가 열리면서 문제가 생겼습니다

> 우리는 이제 웹사이트에서  
> “지갑 연결”, “서명 요청”, “트랜잭션 보내기” 같은 행동을 하고 싶어졌습니다.  
> 즉, **웹과 블록체인이 직접 이어져야만 하는 시대**가 된 거죠.

그런데…

> **브라우저는 블록체인을 모릅니다.  
> 브라우저는 지갑이 뭔지도 모르고, 개인키가 뭔지도 모릅니다.**

## 그래서 등장한 게 바로 이겁니다

> **Ethereum Provider API**

이건 뭐냐면,

> **웹사이트(JavaScript)가 사용자 지갑(예: 메타마스크)과  
> 안전하게 통신할 수 있도록 만들어진 표준 인터페이스입니다.**

### 핵심은 “안전한 연결”

- JavaScript가 지갑에 요청을 보낼 수 있어야 하되,
- 사용자의 승인 없이는 아무것도 실행되지 않아야 하며,
- 민감한 정보(예: 비밀키)는 절대 노출되지 않아야 합니다.

그래서 이 구조를 메타마스크가 **브라우저 확장 프로그램(Extension)**으로 구현하면서,  
**브라우저에 다음 객체를 "직접 삽입"하게 됩니다:**

```js
window.ethereum;
```

## 요약하자면

| 주체         | 설명                                                                   |
| ------------ | ---------------------------------------------------------------------- |
| 브라우저     | 웹페이지 렌더링 및 통신 담당. 지갑? 블록체인? 모릅니다.                |
| 메타마스크   | 브라우저 확장으로 설치됨 → `window.ethereum`을 삽입                    |
| Provider API | dApp(프론트엔드) ↔ 지갑 사이의 공식 인터페이스 (지갑 요청/응답 처리용) |

## 그리고 이 객체 안에 핵심 기능이 있습니다

그게 바로 오늘 우리가 직접 쓴 이 코드죠:

```js
window.ethereum.request({ method: "eth_requestAccounts" });
```

이 메서드는  
→ **지갑에게 "연결 요청"을 보내는 공식적인 방법**입니다.  
→ **Ethereum Provider API**에서 정의한 방식이고,  
→ 내부적으로는 **JSON-RPC**라는 형식으로 구성됩니다.

## 그럼 JSON-RPC란 뭔가요?

JSON-RPC는  
→ **네트워크를 통해 데이터 요청을 주고받을 때 사용하는 형식 중 하나**입니다.  
→ JavaScript Object 형태로 구성되어 있고,  
→ `method`, `params`, `id`, `jsonrpc` 같은 필드로 구성돼요.

## 그럼 우리가 쓴 `eth_requestAccounts`는 실제로 이렇게 생깁니다:

```json
{
  "jsonrpc": "2.0",
  "method": "eth_requestAccounts",
  "params": [],
  "id": 1
}
```

이런 식으로  
→ 웹페이지(JavaScript)가 메타마스크(지갑)에게  
→ **“나 사용자 지갑 주소 좀 알려줘”**라는 요청을 보내는 거예요.

그리고 이 요청은…

> **사용자가 현재 연결한 네트워크 (예: Sepolia)**를 기준으로  
> **그 네트워크 RPC 노드에 전달됩니다.**

즉, 사용자는 **"내가 이 네트워크에서 이 요청을 보낼게요"** 라고  
**서로 약속된 형식(JSON-RPC)으로 요청을 보내는 구조**입니다.

## 쉽게 말하면 이런 거예요:

> **“안녕하세요, 저는 이 웹사이트인데요,  
> 지금 사용자의 지갑 주소가 필요합니다.  
> 지금 Sepolia 네트워크에 연결돼 있으니까,  
> 거기서 확인하고 알려주세요.”**

이런 요청을  
→ 메타마스크가 대신 처리해주는 구조입니다.

- 사용자는 "허용"을 클릭하고,
- 지갑은 서명은 하지 않고 주소만 반환하고,
- 우리 코드에 그 주소가 돌아오게 되는 거죠.

## 그래서 이 구조는 정말 중요합니다

> 단순히 `request()`를 호출하는 게 아니라,  
> 그 안에서 벌어지는 요청 흐름은  
> **“웹사이트 → 브라우저 지갑 → RPC 네트워크”로 이어지는 완전한 트랜잭션 요청의 뼈대**입니다.

## 자, 그럼 `window.ethereum` 안에는 뭐가 있을까?

굉장히 많은 기능들이 들어있지만,  
그 중에서도 **핵심 메서드**는 바로 이겁니다:

```js
window.ethereum.request({ method: "..." });
```

이게 바로 **지갑에게 어떤 행위를 요청하는 공식적인 방식**입니다.  
JSON-RPC 스타일을 그대로 따르고 있어요.

예시:

| 메서드 이름                  | 설명                         |
| ---------------------------- | ---------------------------- |
| `eth_requestAccounts`        | 사용자 지갑 주소 요청 (연결) |
| `eth_sendTransaction`        | 서명 요청 + 트랜잭션 전송    |
| `eth_chainId`                | 현재 네트워크의 체인 ID 조회 |
| `wallet_switchEthereumChain` | 네트워크 전환 요청           |

## 그럼 다시 돌아와서…

```js
await window.ethereum.request({ method: "eth_requestAccounts" });
```

이건 어떤 의미냐면?

> "지갑한테 말 걸기"예요.  
> "혹시 지갑 연결해주실래요?" 하고 요청하는 거예요.  
> 사용자는 팝업으로 "허용"을 클릭함으로써,  
> **자신의 주소를 웹사이트에게 공유하는 걸 승인**하는 겁니다.

## 핵심 정리

| 개념                  | 설명                                                           |
| --------------------- | -------------------------------------------------------------- |
| `window`              | 브라우저가 기본으로 제공하는 전역 객체 (DOM, location 등 포함) |
| `window.ethereum`     | 메타마스크가 삽입한 지갑 인터페이스 객체                       |
| `.request()`          | 지갑에게 JSON-RPC 방식으로 요청을 보내는 표준 메서드           |
| `eth_requestAccounts` | 사용자의 지갑 주소 요청 (서명은 아직 아님)                     |
