# 실행 흐름

아까는 우리가 작성한 코드에 대해

**"어떤 역할을 하는가?"**  
즉, **구현 흐름을 중심으로 정리**했죠.

이번에는 완전히 다른 관점입니다.

**"실제로 어떤 순서로 실행되는가?"**  
즉, 코드가 동작할 때 **브라우저 → 지갑 → 네트워크로 흐르는 실행 순서**를 따라가볼 거예요.

---

## 트랜잭션 발생 시 실행 흐름 (전체 요약)

```js
await contract.methods.increment().send({ from: sender });
```

이 한 줄 안에서 실제로 벌어지는 일들을 시간 순서로 정리하면 다음과 같습니다:

---

### 1. 버튼 클릭 → JavaScript 함수 실행

```html
<button onclick="increment()">카운트 증가</button>
```

사용자가 버튼을 누릅니다 → `increment()` 함수가 실행됩니다.

---

### 2. 지갑 연결 요청 (`eth_requestAccounts`)

```js
await window.ethereum.request({ method: "eth_requestAccounts" });
```

- 브라우저는 메타마스크에  
  → **"지갑 연결 요청"**을 보냅니다
- 메타마스크는 팝업을 띄워 사용자에게  
  → **"이 사이트에 지갑을 연결할까요?"**라고 묻습니다
- 사용자가 허용을 클릭하면  
  → 선택된 주소가 코드로 전달됩니다

---

### 3. ABI 불러오기 → 컨트랙트 인스턴스 생성

```js
await loadABI();
const contract = new web3.eth.Contract(contractABI, address);
```

- 우리가 만든 ABI를 브라우저가 받아오고,
- 해당 주소에 배포된 컨트랙트를 가리키는 web3 인스턴스를 생성합니다

---

### 4. 트랜잭션 생성 요청 (`send()` 실행)

```js
await contract.methods.increment().send({ from: sender });
```

- web3는 **트랜잭션 요청을 JSON-RPC 형식으로 메타마스크(window.ethereum)에 전달**합니다
- 예: `eth_sendTransaction`

---

### 5. 메타마스크 팝업 등장 – 사용자 승인 대기

- 메타마스크는 트랜잭션 내용을 사용자에게 보여줍니다
- 이 때 사용자에게 물어봅니다:

> "이 increment 함수 실행을 승인하시겠습니까?  
> 약간의 가스비가 발생합니다."

- 사용자가 **확인 버튼을 클릭**해야만 다음 단계로 넘어갑니다

---

### 6. 메타마스크가 내부적으로 서명 수행

- 사용자가 확인을 누르면,
- 메타마스크는 해당 주소에 매핑된 비밀키로  
  → **트랜잭션에 서명**합니다 (사용자만이 가능)

---

### 7. 트랜잭션 전송 (→ 블록체인 네트워크)

- 서명된 트랜잭션은 메타마스크가  
  → **현재 연결된 네트워크(Sepolia 등)의 RPC로 직접 전송**합니다
- 이 때 트랜잭션 해시가 생성됩니다

---

### 8. 트랜잭션 처리 대기 → 채굴 → 블록에 포함

- 노드가 트랜잭션을 수신하고
- 블록에 포함시키는 과정을 거치게 됩니다
- 이때 실제로 상태가 바뀝니다 (카운트 증가)

---

### 9. 트랜잭션 해시 반환

```js
resultDiv.textContent = `트랜잭션 해시: ${tx.transactionHash}`;
```

- 트랜잭션이 정상적으로 처리되면
- 해시가 우리 코드로 돌아오고,
- 브라우저 화면에 표시됩니다

---

## 자, 그럼 이걸로 뭘 할 수 있냐?

→ **이제 이 트랜잭션 해시를 Etherscan에 입력해보세요!**

- 우리가 만든 트랜잭션이 실제 블록체인에 기록됐는지 확인할 수 있습니다
- 언제 발생했는지, 어떤 주소가 보냈는지, 가스는 얼마 들었는지
- 모두 확인 가능!

---

## 다음 스텝

그래서 다음 시간에는  
**Etherscan을 직접 탐색해보며**,

- CA (Contract Address)
- TxHash (Transaction Hash)
- 상태 (Success / Pending / Fail)
- 블록 번호, 가스 사용량, 서명자 주소 등등

**블록 탐색기(Block Explorer)의 구조와 역할을 완전히 파악해보는 시간**을 가질 겁니다.
