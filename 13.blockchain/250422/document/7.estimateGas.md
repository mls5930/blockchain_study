# 이더리움에서 코드를 실행하면 무슨 일이 벌어질까?

우리가 일반 코드(Javascript 등)를 실행하면 컴퓨터가 바로 연산하죠.  
그런데 이더리움은 다릅니다.

> **이더리움에서 코드를 실행하는 건 돈이 드는 일입니다.**

실행 = 연산 = 가스 소비 = 돈.  
→ 그래서 **실행 전에 “얼마 들지?” 를 먼저 계산해야 해요.**

---

## `estimateGas()`는 이걸 묻는 함수예요.

> “**이 함수, 실제로 실행하면 얼마나 가스 먹을까?**”  
> → 이걸 EVM에게 *시뮬레이션 요청*하는 거예요.

- 진짜로 실행하지 않고,
- 블록에 기록하지도 않고,
- **EVM이 ‘가짜로 한 번 돌려봐주는’ 행위**입니다.

---

## 어떤 관점으로 보면 쉽게 이해될까?

### 1. **“견적 요청” 관점**

```ts
await contract.methods.increment().estimateGas({ from: account });
```

이건 마치…

> “야, 내가 이 `increment()` 함수 실행하려고 하는데  
> 대충 얼마쯤 드는지 한 번 계산해줘.”

→ 그러면 EVM이 실제로 실행은 안 하고,  
→ **“이거 한 21,000 가스쯤 들겠는데?”** 하고 알려줘요.

---

### 2. **“트랜잭션 실패 방지용 안전장치” 관점**

이더리움에서는 `gas`를 너무 적게 설정하면 실행하다가 중간에 멈춰요.  
그래서 트랜잭션 보내기 전에 `estimateGas()`로 **최소한 필요한 양을 확인**하는 거예요.

> 즉, `estimateGas()`는  
> **"이 함수, 이 조건, 이 입력값이면 최소 얼마 필요해요"**를 알려주는 **보험** 같은 존재예요.

---

## 예시로 감 잡기

```ts
await contract.methods.transfer(to, 1000).estimateGas({ from: sender });
```

이건 다음을 묻는 거예요:

> “이 계정(sender)에서 저 계정(to)으로  
> 1000개 토큰 보내면  
> 블록에 기록되기 전에 대략 얼마나 가스 쓸 것 같아?”

---

## 결론 한 줄 요약

> `estimateGas()`는  
> **이더리움이라는 유료 연산 환경에서,  
> 트랜잭션 실패를 막기 위해 반드시 거쳐야 하는 "사전 시뮬레이션" 절차입니다.**
>
> **“실행 = 돈”이라는 철학 아래에서,  
> 견적을 먼저 뽑아보는 관행을 익히는 게 블록체인 개발의 출발점이에요.**

---

이 코드:

```ts
const gas = await contract.methods
  .increment()
  .estimateGas({ from: accounts[0] });
```

# 어떤 시각으로 이 코드를 받아들이면 되는가?

---

### **"실행 비용 미리 계산하기"**

> 블록체인에서 `increment()`를 실행하는 건  
> **그냥 코드 실행이 아니라 ‘돈이 드는 요청’이에요.**

그래서 이 코드는 이렇게 해석돼요:

> "나, `accounts[0]` 계정으로 `increment()`를 실행할 건데,  
> 그 전에 **대충 얼마쯤 가스가 들지** 한 번 계산해줘."

이게 **실행 이전에 안전하게 예산 뽑아보는 습관**이에요.

---

### **“실패하지 않게 미리 시뮬레이션 돌리기”**

이 코드 없으면 어떻게 될 수 있냐면?

```ts
await contract.methods.increment().send({
  from: accounts[0],
  gas: "10000", // 실수로 너무 작게 설정!
});
```

→ 실행 도중 멈추고, 트랜잭션 실패하고, **가스는 날리고**, **변경은 안 되고**, **되돌릴 수도 없어요.**

그래서 `estimateGas()`는 **"이거 실행해도 괜찮을지 시뮬 돌려봐줘"**라는 의미로 이해하면 됩니다.

---

### **실행이 아닌, ‘예측’**

이 코드는 _실행이 아니라_ _예측이에요_.

- 실제 블록에 기록도 안 하고
- 상태도 안 바꾸고
- 단지 “얼마 가스 들지?”만 계산합니다.

그래서 완전히 안전하고, 실패도 없고, 결과만 숫자로 줘요.

---

## 정리해서 다시 써보면

```ts
const gas = await contract.methods
  .increment()
  .estimateGas({ from: accounts[0] });
```

→ **“accounts[0] 주소가 이 increment() 함수를 실행하면  
가스가 얼마나 들 것 같아?”** 를 **EVM한테 시뮬레이션 요청한 것**이에요.

---

## 한 줄 요약

> **블록체인에서 실행은 비용이 드는 일이기 때문에,  
> 실행 전에 `estimateGas()`로 예산을 먼저 뽑아보는 건 필수적인 습관입니다.**  
> 이 코드는 그 철학을 가장 잘 보여주는 한 줄이에요.
