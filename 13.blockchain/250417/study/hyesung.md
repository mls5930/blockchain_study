# 오늘 뭐가 궁금했나?

README.md에서 처음에 소켓 연결전에 HTTP로 먼저 요청을 하고  
다음에 웹소켓이 TCP로 업그레이드 해준다고?

## WebSocket

맞아. 정확하게 잘 짚었어.  
**WebSocket**을 이해하려면 먼저 **TCP 통신이 뭔지** 알아야 하고,  
왜 WebSocket이 등장했는지를 생각해봐야 전체 맥락이 잡혀.

---

## 1. WebSocket이 무엇인지 알아보기 전에

### 먼저, 질문부터 던져볼게:

- 웹에서는 이미 HTTP라는 통신 방식이 있잖아?
- 근데 **왜 WebSocket이라는 새 통신 방식이 필요했을까?**

---

## 2. 그 전에: TCP란 무엇인가?

**TCP (Transmission Control Protocol)**는  
인터넷에서 데이터를 **신뢰성 있게, 순서대로** 주고받게 해주는 **운송 수단**이야.

- 데이터를 **잘게 쪼개서** 보냄
- 상대방이 **다 받았는지 확인**함
- 순서대로 조립함
- **양방향 통신** 가능

즉, _전화기처럼_ 말하고 들을 수 있는 구조야.

---

## 3. HTTP는 왜 아쉬웠을까?

HTTP는 **TCP 위에서 동작하는 규약**이지만, 구조상 이렇게 되어 있어:

> 클라이언트가 요청(request)을 보내야지만  
> 서버가 응답(response)을 줄 수 있어.

즉, 서버는 절대 먼저 말을 못 거는 구조야.

그래서 문제가 생겨:

- 클라이언트가 계속 "새 소식 있어요?" 하고 물어야 함 (polling)
- 실시간 게임, 채팅, 주식 데이터 등 **빠른 반응이 필요한 서비스**에 불리함

---

## 4. 그래서 WebSocket이 나옴

**WebSocket**은 말 그대로 "웹에서 TCP처럼 양방향으로 실시간 대화할 수 있게 해주는 통신 방식"이야.

**기본 아이디어:**

- 처음 한 번은 HTTP로 연결을 시작해 (handshake)
- 그 뒤엔 **TCP 기반의 양방향 연결로 바꿔치기** 함 (업그레이드!)
- 이후엔 양쪽이 마음대로 데이터를 주고받을 수 있음

---

## 5. 다시 돌아와서:

> **WebSocket 객체는 어떤 걸 하려고 만들어졌는가?**

→ **브라우저에서 직접 서버와 TCP처럼 실시간으로 통신하고 싶을 때 사용하는 객체**  
→ HTTP 방식의 한계를 넘어서 **서버와 쌍방향 통신**을 만들기 위한 도구

---

원하는 방향으로 흐름을 이어서 정리하자면 다음과 같아:

1. TCP 통신 개념 먼저 이해
2. HTTP가 TCP 위에서 어떻게 동작하는지 이해
3. HTTP의 한계(Polling)와 실시간성 요구
4. WebSocket의 등장 이유
5. WebSocket 객체의 역할과 동작 방식

## `웹소켓으로 업그레이드 하기 전에` HTTP로 한 번 요청을 보내고 그 다음에 TCP 기반으로 하는 웹소켓으로 사용해서 업그레이드해서 양방향 통신이 되었다라고 공부했음.

웹소켓으로 업그레이드 하기 전에???

어떤 상황을 말하는건가??

### “웹소켓으로 업그레이드 하기 전에”란 도대체 어떤 상황을 말하는 건가요?

---

## 정확한 설명:

### **“업그레이드 전”이란?**

- 클라이언트(브라우저)가 서버에 **HTTP 요청을 보낼 때**,  
  **특별히 `Upgrade: websocket`이라는 헤더를 넣어서 요청**하는 상황을 말함.

즉, 이 요청은 단순히 페이지를 요청하는 게 아니라:

> “나 지금 너한테 웹페이지 요청하는 게 아니라,  
> **WebSocket 연결을 하고 싶어서 왔어.**  
> 지금은 HTTP지만, **곧 TCP로 바꿔서 진짜 소켓 통신할 거야**.”

라는 의도가 담긴 요청이야.

---

## 실제 흐름 요약

1. **브라우저가 서버에 보냄:**

   ```http
   GET /chat HTTP/1.1
   Host: server.example.com
   Upgrade: websocket
   Connection: Upgrade
   Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
   Sec-WebSocket-Version: 13
   ```

2. **서버가 응답함:**

   ```http
   HTTP/1.1 101 Switching Protocols
   Upgrade: websocket
   Connection: Upgrade
   Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
   ```

3. **이제부터는 HTTP 아님.**  
   **진짜 TCP 소켓 통신으로 바뀜.**  
   양방향으로 자유롭게 데이터 주고받을 수 있음.

---

## 오해 풀기

> **“HTTP 요청을 보낸 다음 TCP로 업그레이드한다”**는 말은  
> ‘HTTP에서 TCP로 업그레이드하는 것’이 아님.

- **HTTP는 애초에 TCP 위에서 동작**
- **WebSocket도 TCP 위에서 동작**
- 즉, **TCP는 둘 다 공유함**

정확히 말하면:

> **HTTP 프로토콜 → WebSocket 프로토콜로 바꾸는 과정이다.**  
> TCP는 그대로고, 위에서 사용하는 규칙만 바뀌는 거임.

---

## 비유

> **“택배 상자를 보낼 때 처음엔 종이봉투에 담아 보내고, 상대방이 확인하면 박스로 다시 포장해서 계속 주고받는 구조”**

- 종이봉투 = HTTP 요청
- 박스 포장 = WebSocket 연결
- 택배차 = TCP 연결

→ 차(TCP)는 동일, 포장만 바뀐 거야.

---

## 정리

| 구분            | 설명                                                          |
| --------------- | ------------------------------------------------------------- |
| 업그레이드 전   | 브라우저가 **HTTP GET 요청 + Upgrade: websocket** 헤더를 보냄 |
| 업그레이드 순간 | 서버가 101 Switching Protocols 응답                           |
| 업그레이드 후   | HTTP 규칙을 버리고, WebSocket 규칙으로 TCP 통신 시작          |
| 핵심            | TCP 연결은 그대로 유지됨. 프로토콜만 바뀜                     |

## 주의!!

## “WebSocket은 TCP로 업그레이드하는 게 아니에요.”

1. HTTP와 WebSocket은 **둘 다 TCP 위에서 돌아가는 통신 규약**이에요.
2. WebSocket은 단지 **HTTP 방식의 한계를 넘기 위해** 사용하는 다른 규약이에요.
3. ‘Upgrade’라는 표현은 단지 **프로토콜을 바꾸는 과정**일 뿐,
   TCP로 넘어간다는 뜻도 아니고, 상하관계도 아니에요.
4. TCP는 그냥 **신뢰성 있는 통로**일 뿐,
   그 위에서 어떤 말을 하느냐(HTTP냐 WebSocket이냐)는 선택이에요.

### **“Upgrade”는 ‘좋아진다’는 뜻이 아님.**

- **HTTP → WebSocket** 전환에서 말하는 **"업그레이드"는 "프로토콜 교체"를 의미**할 뿐이야.
- TCP는 그대로고, 그 위에 올라타는 통신 규약만 바뀌는 거야.
- 이건 "상하관계"가 아니고, **"용도에 따라 바꾸는 것"**이야.

---

## 더 명확하게 비유하면

- HTTP는 **정중한 편지 방식**
  - “안녕하세요, 이거 주세요” → “네, 여기 있어요”
  - 매번 편지를 새로 써야 함
- WebSocket은 **전화통화 방식**
  - 연결되면 실시간으로 말할 수 있음
  - 끊기 전까지 계속 이야기 가능

→ 둘 다 말은 전달되지만 **방식이 다를 뿐**, 하나가 상위고 하나가 하위는 아님.

---

## 용어 정리

| 용어      | 설명                                                                             |
| --------- | -------------------------------------------------------------------------------- |
| TCP       | 신뢰성 있는 데이터 연결 통로 (운송 수단)                                         |
| HTTP      | 요청-응답 방식의 프로토콜 (TCP 위에서 동작)                                      |
| WebSocket | 실시간 양방향 통신 프로토콜 (역시 TCP 위에서 동작)                               |
| Upgrade   | TCP 자체가 바뀌는 게 아니라, **HTTP 규칙 → WebSocket 규칙으로 교체**되는 걸 말함 |

---

## 그래서 잘못된 이해 예시

| 오해                                  | 반박                                            |
| ------------------------------------- | ----------------------------------------------- |
| WebSocket은 TCP로 업그레이드한 것이다 | ❌ 이미 HTTP도 TCP 위에서 돌아감                |
| TCP는 상위 버전, HTTP는 하위 버전이다 | ❌ 계층이 다름. TCP는 전송계층, HTTP는 응용계층 |
| WebSocket은 HTTP의 상위이다           | ❌ 전혀 아님. 단지 쓰임새가 다를 뿐             |

## 프로토콜

그리고 프로토콜에 대해서도 공부해야 함.

아까 말 심하게 해서 미안해요.

## 1. 일단 한 줄 요약부터:

> **프로토콜(Protocol)은 서로 다른 시스템이, 오해 없이 소통하기 위해 ‘미리 약속한 대화의 형식’이다.**

---

## 2. 영어 원뜻에서 출발해보자

### 영어 'protocol'의 어원

- **고대 그리스어 _protokollon_**: 문서 위에 붙이는 **'첫 페이지(보증서)'**
- 외교/국제 관계에서 **"국가 간에 서로를 존중하며 지켜야 할 외교 의례"**라는 뜻으로 확장됨

즉, **공동체 간의 공식적인 약속, 신뢰를 위한 규칙**에서 출발한 단어임.

---

## 3. 컴퓨터에서의 프로토콜

이제 이걸 컴퓨터 세계에 가져오면:

> **서로 다른 컴퓨터, 운영체제, 브라우저, 서버**가  
> **“우리가 이렇게 말할게, 너도 이 방식으로 들어줘”**  
> 라고 약속한 **통신의 규칙**을 의미함.

---

## 4. 프로토콜이 필요한 이유: 왜 이 개념이 생겼을까?

### 과거에는?

- 전화선, 모뎀, 운영체제, 문자 인코딩 방식 등 전부 **제각각**이었어.
- 서로 연결은 되는데, 말이 안 통해.
- **표준화**가 없으면, **데이터는 오가지만, 의미는 전달되지 않아.**

그래서 등장한 게 **프로토콜**.

---

## 5. 웹의 발전과 함께한 프로토콜들

| 시대     | 주요 프로토콜     | 의미                               |
| -------- | ----------------- | ---------------------------------- |
| 1960–80s | FTP, SMTP, Telnet | 파일 전송, 메일 전송, 원격 접속 등 |
| 1990s    | HTTP (웹의 출발)  | 정적 문서 기반 웹페이지 전송       |
| 2000s    | HTTPS (보안 강화) | SSL/TLS 기반 암호화 전송           |
| 2010s    | WebSocket, gRPC   | 실시간성, 고성능 통신 요구 대응    |
| 2020s    | QUIC, HTTP/3      | 지연시간 단축, 모바일 최적화       |

---

## 6. 철학적으로 보자면?

> **프로토콜은 신뢰 없는 환경에서 신뢰를 만드는 메커니즘이다.**

- 상대가 누구인지 몰라도,
- 운영체제가 뭔지 몰라도,
- IP가 바뀌어도,  
  → **약속된 규약만 지키면 서로 소통 가능.**

이게 바로 프로토콜이 가진 **탈중앙적 신뢰**의 구조야.  
그래서 **인터넷의 철학**, 나아가 **블록체인의 철학**과도 자연스럽게 연결돼.

---

## 7. 정리: 프로토콜이란?

1. 기술적으로는 → **컴퓨터끼리 소통하기 위한 표준 규칙**
2. 사회문화적으로는 → **공동체가 소통을 위해 정한 약속**
3. 철학적으로는 → **신뢰를 위해 약속을 강제하지 않고 구현하는 구조**

---

## 8. 마지막 한 줄

> 프로토콜은 기술이자 문화이고, 신뢰를 위한 가장 실용적인 약속이다.

웹소켓은 4계층에 존재하는 도구임. 그래서 실시간 통신 => HTTP에 없으니까 4계층으로 돌아가는 거군요?

## 반은 맞고 반은 틀림

> **HTTP 통신이랑 TCP 통신은 별개다.** WebSocket은 그냥 "HTTP 연결 후 TCP로 전환"되는 게 아니라, **HTTP는 연결을 여는 도구일 뿐이고**, **진짜 통신은 TCP에서 별도로 이뤄진다.**

> WebSocket은 HTTP 위에서 동작하지 않는다.  
> **HTTP는 handshake 용도로만 쓰일 뿐, 이후 실시간 통신은 TCP라는 별개의 통신 채널에서 이뤄진다.**  
> 즉, **HTTP 통신과 TCP 통신은 각자 따로 열리는 서로 다른 경로이며**, WebSocket은 이 둘을 연결해주는 "전환의 다리" 역할을 할 뿐이다.

---

혹은 더 간결하게 정리하면:

> WebSocket은 **HTTP로 시작하지만, TCP로 넘어간다.**  
> HTTP와 TCP는 서로 다른 통신이고, WebSocket은 **HTTP와 TCP를 잇는 전환 프로토콜**일 뿐이다.
